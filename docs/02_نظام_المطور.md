# ูุธุงู ุงููุทูุฑ (Developer System)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงููุทูุฑ ูู ุงูุทุจูุฉ ุงูุชูููุฉ ุงูุชู ุชุฑุจุท ุฌููุน ุงูุฃูุธูุฉ ุจุจุนุถูุง ูุชููุฑ ูุงุฌูุงุช ุจุฑูุฌูุฉ (APIs) ููุชูุงูู ุงูุฏุงุฎูู ูุงูุฎุงุฑุฌู.

---

## ๐ฏ ุงูุฃูุฏุงู

1. ุชูููุฑ **APIs ููุญุฏุฉ** ูุฌููุน ุงูุฃูุธูุฉ
2. ุฅุฏุงุฑุฉ **ุงูุชูุงููุงุช ุงูุฎุงุฑุฌูุฉ** (ุจูุงุจุงุช ุงูุฏูุนุ SMSุ IoT)
3. ุชูููุฑ **ูุญุฏุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู** ุงููุฑูุฒูุฉ
4. ุฅุฏุงุฑุฉ **ุงูุฃุญุฏุงุซ ูุงูุฅุดุนุงุฑุงุช** ุจูู ุงูุฃูุธูุฉ
5. ุชูููุฑ **ุฃุฏูุงุช ุงููุฑุงูุจุฉ** ูุงูุชุชุจุน

---

## ๐๏ธ ููููุงุช ูุธุงู ุงููุทูุฑ

```
ูุธุงู ุงููุทูุฑ
    โ
    โโโ 1๏ธโฃ ุทุจูุฉ APIs
    โ   โโโ APIs ุฏุงุฎููุฉ (ุจูู ุงูุฃูุธูุฉ)
    โ   โโโ APIs ุฎุงุฑุฌูุฉ (ููุชุทุจููุงุช)
    โ
    โโโ 2๏ธโฃ ูุญุฑู ุงูุชูุงููุงุช
    โ   โโโ ุจูุงุจุงุช ุงูุฏูุน
    โ   โโโ ุฎุฏูุงุช SMS/WhatsApp
    โ   โโโ ุฃุฌูุฒุฉ IoT (ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ)
    โ   โโโ ุฃูุธูุฉ ุฎุงุฑุฌูุฉ
    โ
    โโโ 3๏ธโฃ ูุญุฏุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
    โ   โโโ ุงูุชูุจุค ุจุงูุงุณุชููุงู
    โ   โโโ ูุดู ุงูุฃุนุทุงู
    โ   โโโ ุชุญุณูู ุงูุชูุฒูุน
    โ   โโโ ุชุญููู ุงูุจูุงูุงุช
    โ
    โโโ 4๏ธโฃ ูุธุงู ุงูุฃุญุฏุงุซ (Event System)
    โ   โโโ ูุดุฑ ุงูุฃุญุฏุงุซ
    โ   โโโ ุงูุงุดุชุฑุงู ูู ุงูุฃุญุฏุงุซ
    โ   โโโ ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ
    โ
    โโโ 5๏ธโฃ ุฃุฏูุงุช ุงููุฑุงูุจุฉ
        โโโ ุณุฌูุงุช ุงููุธุงู
        โโโ ูุฑุงูุจุฉ ุงูุฃุฏุงุก
        โโโ ุงูุชูุจููุงุช ุงูุชูููุฉ
```

---

## 1๏ธโฃ ุทุจูุฉ APIs

### APIs ุงูุฏุงุฎููุฉ:

| API | ุงููุธุงู | ุงูููู | ุงููุตู |
|-----|--------|------|-------|
| `/api/core/*` | ุงููุธุงู ุงูุฃู | `01_ุงููุธุงู_ุงูุฃู.md` | ุงููุณุชุฃุฌุฑููุ ุงููุณุชุฎุฏูููุ ุงูุตูุงุญูุงุชุ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช |
| `/api/assets/*` | ูุธุงู ุงูุฃุตูู (ุงูุดุจูุฉ) | `03_ูุธุงู_ุงูุฃุตูู_ูุงูุตูุงูุฉ.md` | ุงููููุฏุงุชุ ุงูุฃููุงุญ ุงูุดูุณูุฉุ ุงูููุงุจูุ ุงูุนุฏุงุฏุงุช |
| `/api/field/*` | ุงูุนูููุงุช ุงูููุฏุงููุฉ | `04_ูุธุงู_ุงูุนูููุงุช_ุงูููุฏุงููุฉ.md` | ุงูููุงูุ ุงููุฑูุ ุงูุฌุฏุงููุ ุงููุญุต |
| `/api/maintenance/*` | ุงูุฃุตูู ูุงูุตูุงูุฉ | `03_ูุธุงู_ุงูุฃุตูู_ูุงูุตูุงูุฉ.md` | ุงูุฅููุงูุ ุงูุตูุงูุฉ ุงูููุงุฆูุฉุ ูุทุน ุงูุบูุงุฑ |
| `/api/scada/*` | ุงููุฑุงูุจุฉ ูุงูุชุญูู | `05_ูุธุงู_ุงููุฑุงูุจุฉ_ูุงูุชุญูู.md` | SCADAุ ูุฑุงูุจุฉ ุงูุทุงูุฉุ ุงูุชูุจููุงุช |
| `/api/inventory/*` | ุงููุฎุฒูู ูุงููุดุชุฑูุงุช | `06_ูุธุงู_ุงููุฎุฒูู_ูุงููุดุชุฑูุงุช.md` | ุงูุฃุตูุงูุ ุงููุณุชูุฏุนุงุชุ ุงูููุฑุฏููุ ุงููุดุชุฑูุงุช |
| `/api/billing/*` | ุงูุนููุงุก ูุงูููุชุฑุฉ | `07_ูุธุงู_ุงูุนููุงุก_ูุงูููุชุฑุฉ.md` | ุงูุนููุงุกุ ุงูููุงุชูุฑุ ุงูุชุญุตููุ STS |
| `/api/hr/*` | ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ | `08_ูุธุงู_ุงูููุงุฑุฏ_ุงูุจุดุฑูุฉ.md` | ุงูููุธูููุ ุงูุฑูุงุชุจุ ุงูุญุถูุฑุ ุงูุฅุฌุงุฒุงุช |
| `/api/finance/*` | ุงููุธุงู ุงููุงูู | `10_ุงููุธุงู_ุงููุงูู.md` | ุงูุชูุงุฑูุฑ ุงููุงููุฉุ ุงูุชุณููุงุชุ ุงูุญุณุงุจุงุช ุงููุณูุทุฉ |

### APIs ุงูุฎุงุฑุฌูุฉ:

| API | ุงููุตู | ุงููุณุชุฎุฏู |
|-----|-------|----------|
| `/api/v1/customers/*` | ุจูุงุจุฉ ุงูุนููุงุก | ุชุทุจูู ุงูุนููู |
| `/api/v1/mobile/*` | ุชุทุจูู ุงูููุธููู | ุชุทุจูู ุงูุฌูุงู |
| `/api/v1/iot/*` | ุฃุฌูุฒุฉ IoT | ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ |
| `/api/v1/webhooks/*` | ุงูุฅุดุนุงุฑุงุช | ุฃูุธูุฉ ุฎุงุฑุฌูุฉ |

### ูุนุงููุฑ APIs:

```
- RESTful API
- JSON format
- JWT Authentication
- Rate Limiting
- API Versioning (v1, v2, ...)
- OpenAPI/Swagger Documentation
```

---

## 2๏ธโฃ ูุญุฑู ุงูุชูุงููุงุช

### ุจูุงุจุงุช ุงูุฏูุน:

```
ูุญุฑู ุงูุชูุงููุงุช
    โ
    โโโ ุจูุงุจุงุช ูุญููุฉ:
    โ   โโโ ูููุณู
    โ   โโโ ุฌูุงูู
    โ   โโโ ูุงุด
    โ   โโโ ...
    โ
    โโโ ุจูุงุจุงุช ุฏูููุฉ:
        โโโ Stripe
        โโโ PayPal
        โโโ ...
```

### ุฎุฏูุงุช ุงูุฑุณุงุฆู:

```
โโโ SMS:
โ   โโโ ูุฒูุฏ ูุญูู 1
โ   โโโ ูุฒูุฏ ูุญูู 2
โ   โโโ Twilio (ุงุญุชูุงุทู)
โ
โโโ WhatsApp:
    โโโ WhatsApp Business API
```

### ุฃุฌูุฒุฉ IoT:

```
โโโ ุนุฏุงุฏุงุช ACREL:
โ   โโโ WiFi Protocol
โ   โโโ MQTT Protocol
โ   โโโ HTTP API
โ
โโโ ุนุฏุงุฏุงุช STS:
โ   โโโ STS API
โ
โโโ ุฃุฌูุฒุฉ ุฃุฎุฑู:
    โโโ Generic MQTT/HTTP
```

### Webhooks ูู Acrel IoT-EMS:

ูุธุงููุง ูุณุชูุจู ุงูุฃุญุฏุงุซ ุงูููุฑูุฉ ูู ููุตุฉ Acrel ุนุจุฑ Webhooks:

#### Endpoints ูุงุณุชูุจุงู ุงูุฃุญุฏุงุซ:

| Endpoint | ุงูุญุฏุซ | ุงููุตู |
|----------|--------|-------|
| `POST /api/v1/acrel/webhooks/meter-reading` | ูุฑุงุกุฉ ุฌุฏูุฏุฉ | ุงุณุชูุจุงู ูุฑุงุกุฉ ุนุฏุงุฏ ุฌุฏูุฏุฉ |
| `POST /api/v1/acrel/webhooks/alert` | ุชูุจูู | ุงุณุชูุจุงู ุชูุจูู ูู ุงูุนุฏุงุฏ |
| `POST /api/v1/acrel/webhooks/status-change` | ุชุบููุฑ ุญุงูุฉ | ุงุณุชูุจุงู ุชุบููุฑ ุญุงูุฉ ุงูุนุฏุงุฏ |
| `POST /api/v1/acrel/webhooks/disconnect-confirm` | ุชุฃููุฏ ูุตู | ุชุฃููุฏ ุชูููุฐ ุฃูุฑ ุงููุตู |
| `POST /api/v1/acrel/webhooks/reconnect-confirm` | ุชุฃููุฏ ูุตู | ุชุฃููุฏ ุชูููุฐ ุฃูุฑ ุงููุตู |

#### ูููู Payload ููู ุญุฏุซ:

```json
// === ูุฑุงุกุฉ ุฌุฏูุฏุฉ (meter-reading) ===
{
  "event_type": "meter_reading",
  "timestamp": "2024-12-15T10:30:00Z",
  "meter_id": "ACR-001234",
  "meter_type": "ADL200",
  "data": {
    "reading": 15234.56,
    "consumption": 125.5,
    "voltage": 220.5,
    "current": 15.2,
    "power_factor": 0.95
  }
}

// === ุชูุจูู (alert) ===
{
  "event_type": "alert",
  "timestamp": "2024-12-15T10:30:00Z",
  "meter_id": "ACR-001234",
  "alert_type": "over_voltage",
  "severity": "warning",
  "value": 245.5,
  "threshold": 240.0,
  "message": "Voltage exceeded threshold"
}

// === ุชุบููุฑ ุญุงูุฉ (status-change) ===
{
  "event_type": "status_change",
  "timestamp": "2024-12-15T10:30:00Z",
  "meter_id": "ACR-001234",
  "previous_status": "connected",
  "new_status": "disconnected",
  "reason": "remote_command"
}
```

#### ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ:

```python
# ูุนุงูุฌ Webhooks ูู Acrel
class AcrelWebhookHandler:
    
    def handle_meter_reading(self, payload):
        # 1. ุชุญุฏูุซ ูุฑุงุกุฉ ุงูุนุฏุงุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
        # 2. ุญุณุงุจ ุงูุงุณุชููุงู ุงูุฌุฏูุฏ
        # 3. ุชุญุฏูุซ ููุญุฉ ุงูุชุญูู (WebSocket)
        pass
    
    def handle_alert(self, payload):
        # 1. ุฅูุดุงุก ุชูุจูู ูู ุงููุธุงู
        # 2. ุฅุฑุณุงู ุฅุดุนุงุฑ ูููููุฏุณูู
        # 3. ุฅูุดุงุก ุฃูุฑ ุนูู ุฅู ูุฒู
        pass
    
    def handle_status_change(self, payload):
        # 1. ุชุญุฏูุซ ุญุงูุฉ ุงูุนููู
        # 2. ุชุณุฌูู ูู meter_control_log
        # 3. ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู
        pass
```

#### ุฃูุงู Webhooks:

| ุงูุฅุฌุฑุงุก | ุงููุตู |
|---------|-------|
| HMAC Signature | ุงูุชุญูู ูู ุชูููุน ุงูุทูุจ |
| IP Whitelist | ูุจูู ุงูุทูุจุงุช ูู IPs ูุญุฏุฏุฉ ููุท |
| Timestamp Validation | ุฑูุถ ุงูุทูุจุงุช ุงููุฏููุฉ (> 5 ุฏูุงุฆู) |
| Idempotency | ููุน ูุนุงูุฌุฉ ููุณ ุงูุญุฏุซ ูุฑุชูู |

### ูููุฐุฌ ุงูุชูุงูู:

```python
# ูุซุงู: ุฅุฑุณุงู SMS
class SMSIntegration:
    providers = ['local_1', 'local_2', 'twilio']
    
    def send(self, phone, message):
        for provider in self.providers:
            try:
                return provider.send(phone, message)
            except:
                continue  # ุฌุฑุจ ุงููุฒูุฏ ุงูุชุงูู
        raise AllProvidersFailed()
```

### ุฎุฏูุงุช MQTT ูุชูุงูู Acrel:

> **ููุงุญุธุฉ ูููุฉ:** ุจูุง ุฃู ููุตุฉ Acrel IoT-EMS ูุซุจุชุฉ ูุญููุงู (On-Premise)ุ ูุฅู ุงูููุตุฉ ุชุชููู ุฅุฏุงุฑุฉ ุงูุงุชุตุงู ูุน ุงูุนุฏุงุฏุงุช ุนุจุฑ MQTT. ูุธุงููุง ูุชูุงุตู ูุน API ุงูููุตุฉ ูุจุงุดุฑุฉ. ููุน ุฐููุ ูููู ุงูุงุดุชุฑุงู ูู MQTT Topics ููุญุตูู ุนูู ุจูุงูุงุช ูุญุธูุฉ.

#### 1. ูุณุชูุน MQTT (MQTT Listener Service):

```python
# ุฎุฏูุฉ ุงูุงุณุชูุงุน ูุฑุณุงุฆู MQTT ูู Acrel
class AcrelMQTTListener:
    """
    ุฎุฏูุฉ ุชุนูู ูู ุงูุฎูููุฉ ููุงุณุชูุงุน ูุฑุณุงุฆู MQTT
    ูู ููุตุฉ Acrel ุงููุญููุฉ
    """
    
    def __init__(self):
        self.broker = "acrel-server.local"  # ุฎุงุฏู Acrel ุงููุญูู
        self.port = 1883
        self.topics = [
            "acrel/+/meter/+/data",      # ุจูุงูุงุช ุงูุนุฏุงุฏุงุช
            "acrel/+/meter/+/alert",     # ุชูุจููุงุช ุงูุนุฏุงุฏุงุช
            "acrel/+/meter/+/status",    # ุชุบููุฑ ุงูุญุงูุฉ
        ]
    
    def on_message(self, topic, payload):
        """ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ"""
        data = json.loads(payload)
        
        if "/data" in topic:
            self.handle_meter_reading(data)
        elif "/alert" in topic:
            self.handle_alert(data)
        elif "/status" in topic:
            self.handle_status_change(data)
    
    def handle_meter_reading(self, data):
        # ุชุญุฏูุซ ููุญุฉ ุงูุชุญูู ุนุจุฑ WebSocket
        websocket.broadcast("meter_update", data)
    
    def handle_alert(self, data):
        # ุฅูุดุงุก ุชูุจูู + ุฅุฑุณุงู SMS ูููููุฏุณูู
        AlertService.create(data)
        SMSService.notify_engineers(data)
    
    def handle_status_change(self, data):
        # ุชุญุฏูุซ ุญุงูุฉ ุงูุนููู + ุชุณุฌูู
        CustomerService.update_status(data)
```

#### 2. ูุงุดุฑ ุฃูุงูุฑ MQTT (MQTT Command Publisher):

```python
# ุฎุฏูุฉ ูุดุฑ ุงูุฃูุงูุฑ ุฅูู ุงูุนุฏุงุฏุงุช ุนุจุฑ Acrel
class AcrelCommandPublisher:
    """
    ุฎุฏูุฉ ููุดุฑ ุฃูุงูุฑ ุงูุชุญูู ุฅูู ุงูุนุฏุงุฏุงุช
    ุนุจุฑ ููุตุฉ Acrel ุงููุญููุฉ
    """
    
    def __init__(self):
        self.broker = "acrel-server.local"
        self.port = 1883
    
    def disconnect_meter(self, station_id, meter_id):
        """ูุตู ุงูุฎุฏูุฉ ุนู ุนุฏุงุฏ"""
        topic = f"acrel/{station_id}/meter/{meter_id}/command"
        payload = {
            "command": "relay_off",
            "timestamp": datetime.utcnow().isoformat(),
            "source": "billing_system"
        }
        self.publish(topic, payload)
        return self.wait_for_confirmation(meter_id, "disconnected")
    
    def reconnect_meter(self, station_id, meter_id):
        """ุฅุนุงุฏุฉ ุชูุตูู ุงูุฎุฏูุฉ"""
        topic = f"acrel/{station_id}/meter/{meter_id}/command"
        payload = {
            "command": "relay_on",
            "timestamp": datetime.utcnow().isoformat(),
            "source": "billing_system"
        }
        self.publish(topic, payload)
        return self.wait_for_confirmation(meter_id, "connected")
    
    def set_tariff(self, station_id, meter_id, tariff_id):
        """ุชุบููุฑ ุงูุชุนุฑูุฉ"""
        topic = f"acrel/{station_id}/meter/{meter_id}/command"
        payload = {
            "command": "set_tariff",
            "tariff_id": tariff_id,
            "timestamp": datetime.utcnow().isoformat()
        }
        self.publish(topic, payload)
```

#### 3. ุจููุฉ MQTT Topics:

| Topic | ุงูุงุชุฌุงู | ุงููุตู |
|-------|---------|-------|
| `acrel/{station}/meter/{id}/data` | โ ุงุณุชูุจุงู | ุจูุงูุงุช ุงูุนุฏุงุฏ (ูุฑุงุกุฉุ ุฌูุฏุ ุชูุงุฑ) |
| `acrel/{station}/meter/{id}/alert` | โ ุงุณุชูุจุงู | ุชูุจููุงุช ุงูุนุฏุงุฏ |
| `acrel/{station}/meter/{id}/status` | โ ุงุณุชูุจุงู | ุชุบููุฑ ุญุงูุฉ ุงูุนุฏุงุฏ |
| `acrel/{station}/meter/{id}/command` | โ ุฅุฑุณุงู | ุฃูุงูุฑ ุงูุชุญูู |
| `acrel/{station}/infrastructure/{id}/data` | โ ุงุณุชูุจุงู | ุจูุงูุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ |

---

## 3๏ธโฃ ูุญุฏุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู

### ุงูุชูุจุค ุจุงูุงุณุชููุงู:

```
ุงููุฏุฎูุงุช:
โโโ ุจูุงูุงุช ุงูุงุณุชููุงู ุงูุชุงุฑูุฎูุฉ
โโโ ุจูุงูุงุช ุงูุทูุณ
โโโ ุฃูุงู ุงูุฃุณุจูุน/ุงูุนุทู
โโโ ุงูุฃุญุฏุงุซ ุงูุฎุงุตุฉ

ุงููุฎุฑุฌุงุช:
โโโ ุชููุน ุงูุงุณุชููุงู ุงููููู
โโโ ุชููุน ุงูุงุณุชููุงู ุงูุฃุณุจูุนู
โโโ ุชููุน ุงูุฐุฑูุฉ
โโโ ุชูุตูุงุช ุงูุชุดุบูู
```

### ูุดู ุงูุฃุนุทุงู:

```
ุงููุฏุฎูุงุช:
โโโ ูุฑุงุกุงุช ุงูุนุฏุงุฏุงุช
โโโ ุจูุงูุงุช ุงููููุฏุงุช
โโโ ุจูุงูุงุช ุงูุดุจูุฉ
โโโ ุณุฌู ุงูุฃุนุทุงู ุงูุณุงุจูุฉ

ุงููุฎุฑุฌุงุช:
โโโ ุชูุจููุงุช ูุจูุฑุฉ
โโโ ุชุญุฏูุฏ ูููุน ุงูุนุทู ุงููุญุชูู
โโโ ุชูุตูุงุช ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
โโโ ุชูุฏูุฑ ููุช ุงูุฅุตูุงุญ
```

### ุชุญุณูู ุงูุชูุฒูุน:

```
ุงููุฏุฎูุงุช:
โโโ ุทุงูุฉ ุงููุญุทุงุช ุงููุชุงุญุฉ
โโโ ุงูุทูุจ ุงูุญุงูู
โโโ ุญุงูุฉ ุงูููุงุจู
โโโ ุฃููููุงุช ุงูููุงุทู

ุงููุฎุฑุฌุงุช:
โโโ ุฎุทุฉ ุงูุชูุฒูุน ุงููุซูู
โโโ ุชูุตูุงุช ุชุญููู ุงูุฃุญูุงู
โโโ ุชูุจููุงุช ุงูุญูู ุงูุฒุงุฆุฏ
โโโ ุชูุงุฑูุฑ ุงูููุงุกุฉ
```

---

## 4๏ธโฃ ูุธุงู ุงูุฃุญุฏุงุซ (Event System)

### ุฃููุงุน ุงูุฃุญุฏุงุซ:

```
ุงูุฃุญุฏุงุซ
    โ
    โโโ ุฃุญุฏุงุซ ุงููุดุชุฑููู:
    โ   โโโ subscriber.created
    โ   โโโ subscriber.updated
    โ   โโโ subscriber.meter_reading
    โ   โโโ subscriber.payment
    โ
    โโโ ุฃุญุฏุงุซ ุงูููุชุฑุฉ:
    โ   โโโ invoice.created
    โ   โโโ invoice.paid
    โ   โโโ invoice.overdue
    โ   โโโ invoice.cancelled
    โ
    โโโ ุฃุญุฏุงุซ ุงูุฃุตูู:
    โ   โโโ asset.fault_detected
    โ   โโโ asset.maintenance_due
    โ   โโโ asset.status_changed
    โ   โโโ asset.reading_received
    โ
    โโโ ุฃุญุฏุงุซ ุงูุดุจูุฉ:
    โ   โโโ network.overload
    โ   โโโ network.outage
    โ   โโโ network.restored
    โ   โโโ network.switch_changed
    โ
    โโโ ุฃุญุฏุงุซ ุงููุธุงู ุงููุงูู:
    โ   โโโ finance.report_generated
    โ   โโโ finance.settlement_completed
    โ   โโโ finance.period_closed
    โ   โโโ finance.reconciliation_mismatch
    โ
    โโโ ุฃุญุฏุงุซ ุงููุธุงู:
        โโโ system.backup_completed
        โโโ system.error
        โโโ system.alert
```

### ุงูุงุดุชุฑุงู ูู ุงูุฃุญุฏุงุซ:

```python
# ูุซุงู: ุงูุงุดุชุฑุงู ูู ุญุฏุซ
@event_handler('invoice.overdue')
def handle_overdue_invoice(event):
    invoice = event.data
    # ุฅุฑุณุงู ุชุฐููุฑ ููุนููู
    send_reminder(invoice.subscriber)
    # ุชุณุฌูู ูู ุณุฌู ุงูุชุญุตูู
    log_collection_action(invoice)
```

---

## 5๏ธโฃ ุฃุฏูุงุช ุงููุฑุงูุจุฉ

### ุณุฌูุงุช ุงููุธุงู:

```
โโโ Application Logs (ุณุฌูุงุช ุงูุชุทุจูู)
โโโ Access Logs (ุณุฌูุงุช ุงููุตูู)
โโโ Error Logs (ุณุฌูุงุช ุงูุฃุฎุทุงุก)
โโโ Audit Logs (ุณุฌูุงุช ุงูุชุฏููู)
โโโ Performance Logs (ุณุฌูุงุช ุงูุฃุฏุงุก)
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก:

```
โโโ Response Time (ููุช ุงูุงุณุชุฌุงุจุฉ)
โโโ Throughput (ูุนุฏู ุงููุนุงูุฌุฉ)
โโโ Error Rate (ูุนุฏู ุงูุฃุฎุทุงุก)
โโโ CPU/Memory Usage (ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ)
โโโ Database Performance (ุฃุฏุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช)
```

### ุงูุชูุจููุงุช ุงูุชูููุฉ:

```
โโโ High Error Rate โ ุชูุจูู ููุฑู
โโโ Slow Response โ ุชูุจูู ุชุญุฐูุฑู
โโโ Service Down โ ุชูุจูู ุญุฑุฌ
โโโ Disk Space Low โ ุชูุจูู ุชุญุฐูุฑู
โโโ Security Alert โ ุชูุจูู ุญุฑุฌ
```

---

## ๐ ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ

```sql
-- ุงูุชูุงููุงุช
integrations            -- ูุงุฆูุฉ ุงูุชูุงููุงุช
integration_configs     -- ุฅุนุฏุงุฏุงุช ูู ุชูุงูู
integration_logs        -- ุณุฌูุงุช ุงูุชูุงููุงุช

-- ุงูุฃุญุฏุงุซ
events                  -- ุงูุฃุญุฏุงุซ
event_subscriptions     -- ุงูุงุดุชุฑุงูุงุช ูู ุงูุฃุญุฏุงุซ
event_logs              -- ุณุฌูุงุช ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ

-- APIs
api_keys                -- ููุงุชูุญ API
api_rate_limits         -- ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู
api_logs                -- ุณุฌูุงุช ุงุณุชุฎุฏุงู API

-- ุงููุฑุงูุจุฉ
system_logs             -- ุณุฌูุงุช ุงููุธุงู
performance_metrics     -- ููุงููุณ ุงูุฃุฏุงุก
alerts                  -- ุงูุชูุจููุงุช
alert_rules             -- ููุงุนุฏ ุงูุชูุจููุงุช
```

---

## ๐ ุดุงุดุงุช ูุธุงู ุงููุทูุฑ

### 1. ููุญุฉ ุชุญูู ุงููุทูุฑ:
- ูุธุฑุฉ ุนุงูุฉ ุนูู ุตุญุฉ ุงููุธุงู
- ุฅุญุตุงุฆูุงุช APIs
- ุงูุชูุงููุงุช ุงููุดุทุฉ
- ุงูุชูุจููุงุช ุงูุญุงููุฉ

### 2. ุฅุฏุงุฑุฉ APIs:
- ูุงุฆูุฉ APIs
- ุชูุซูู APIs
- ููุงุชูุญ API
- ุฅุญุตุงุฆูุงุช ุงูุงุณุชุฎุฏุงู

### 3. ุฅุฏุงุฑุฉ ุงูุชูุงููุงุช:
- ูุงุฆูุฉ ุงูุชูุงููุงุช
- ุฅุนุฏุงุฏุงุช ูู ุชูุงูู
- ุงุฎุชุจุงุฑ ุงูุชูุงูู
- ุณุฌูุงุช ุงูุชูุงูู

### 4. ูุฑุงูุจุฉ ุงููุธุงู:
- ุณุฌูุงุช ุงููุธุงู
- ููุงููุณ ุงูุฃุฏุงุก
- ุงูุชูุจููุงุช
- ุงูุฑุณูู ุงูุจูุงููุฉ

### 5. ุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ:
- ูุงุฆูุฉ ุงูุฃุญุฏุงุซ
- ุงูุงุดุชุฑุงูุงุช
- ุณุฌูุงุช ุงููุนุงูุฌุฉ

---

## ๐ ุณูุฑ ุงูุนูู

### ุฅุถุงูุฉ ุชูุงูู ุฌุฏูุฏ:

```
1. ุฅูุดุงุก ุงูุชูุงูู ูู ุงููุธุงู
2. ุฅุฏุฎุงู ุงูุฅุนุฏุงุฏุงุช (API keys, URLs, etc.)
3. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
4. ุชูุนูู ุงูุชูุงูู
5. ูุฑุงูุจุฉ ุงูุณุฌูุงุช
```

### ุฅูุดุงุก API Key:

```
1. ุชุญุฏูุฏ ุงูุตูุงุญูุงุช ุงููุทููุจุฉ
2. ุชุญุฏูุฏ ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู
3. ุฅูุดุงุก ุงูููุชุงุญ
4. ุชุณููู ุงูููุชุงุญ ูููุณุชุฎุฏู
5. ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู
```

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู ุงูููุชุฑุญ

| ุงููููุฉ | ุงููุฏุฉ |
|--------|-------|
| ุทุจูุฉ APIs ุงูุฃุณุงุณูุฉ | ุฃุณุจูุนุงู |
| ูุญุฑู ุงูุชูุงููุงุช | 3 ุฃุณุงุจูุน |
| ูุธุงู ุงูุฃุญุฏุงุซ | ุฃุณุจูุนุงู |
| ุฃุฏูุงุช ุงููุฑุงูุจุฉ | ุฃุณุจูุน |
| ูุญุฏุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุฃุณุงุณู) | 3 ุฃุณุงุจูุน |
| **ุงูุฅุฌูุงูู** | **11 ุฃุณุจูุน** |

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **APIs ููุญุฏุฉ** - ูู ุงูุฃูุธูุฉ ุชุชูุงุตู ุนุจุฑ APIs
2. **Fallback** - ูู ุชูุงูู ูู ุจุฏูู ุงุญุชูุงุทู
3. **ุงููุฑุงูุจุฉ** - ูู ุดูุก ููุณุฌู ูููุฑุงูุจ
4. **ุงูุฃูุงู** - JWT + Rate Limiting + API Keys

---

## ๐ ุงูุฃูุธูุฉ ุงููุฑุชุจุทุฉ

| # | ุงููุธุงู | ุงูููู | ุฏูุฑ ูุธุงู ุงููุทูุฑ |
|---|--------|------|------------------|
| 01 | ุงููุธุงู ุงูุฃู | `01_ุงููุธุงู_ุงูุฃู.md` | ุชูููุฑ APIs ูููุณุชุฃุฌุฑููุ ุงูุตูุงุญูุงุชุ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช |
| 03 | ูุธุงู ุงูุฃุตูู (ุงูุดุจูุฉ) | `03_ูุธุงู_ุงูุฃุตูู_ูุงูุตูุงูุฉ.md` | ุงุณุชูุจุงู ุจูุงูุงุช IoTุ ูุฑุงูุจุฉ ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ |
| 04 | ุงูุนูููุงุช ุงูููุฏุงููุฉ | `04_ูุธุงู_ุงูุนูููุงุช_ุงูููุฏุงููุฉ.md` | APIs ูุชุทุจูู ุงูุฌูุงูุ ุฅุฏุงุฑุฉ ุงูููุงูุ GPS |
| 05 | ุงูุฃุตูู ูุงูุตูุงูุฉ | `03_ูุธุงู_ุงูุฃุตูู_ูุงูุตูุงูุฉ.md` | ุฃุญุฏุงุซ ุงูุตูุงูุฉ ุงูููุงุฆูุฉุ ุชูุจููุงุช ุงูุฅููุงู |
| 06 | ุงููุฑุงูุจุฉ ูุงูุชุญูู | `05_ูุธุงู_ุงููุฑุงูุจุฉ_ูุงูุชุญูู.md` | ุชูุงูู SCADAุ ุฃุญุฏุงุซ ุงูุดุจูุฉุ ุงูุชูุจููุงุช |
| 07 | ุงููุฎุฒูู ูุงููุดุชุฑูุงุช | `06_ูุธุงู_ุงููุฎุฒูู_ูุงููุดุชุฑูุงุช.md` | APIs ุงูููุฑุฏููุ ุชูุจููุงุช ุฅุนุงุฏุฉ ุงูุทูุจ |
| 08 | ุงูุนููุงุก ูุงูููุชุฑุฉ | `07_ูุธุงู_ุงูุนููุงุก_ูุงูููุชุฑุฉ.md` | ุจูุงุจุงุช ุงูุฏูุนุ SMS/WhatsAppุ ุจูุงุจุฉ ุงูุนููู |
| 09 | ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ | `08_ูุธุงู_ุงูููุงุฑุฏ_ุงูุจุดุฑูุฉ.md` | ุชูุงูู ุงูุจุตูุฉุ ุฃุญุฏุงุซ ุงูุฑูุงุชุจ |
| 10 | ุงููุธุงู ุงููุงูู | `10_ุงููุธุงู_ุงููุงูู.md` | APIs ุงูุชูุงุฑูุฑุ ุฃุญุฏุงุซ ุงูุชุณููุฉุ ุงูุฅููุงู ุงูุดูุฑู |


---

## ๐ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงูุชูุตูููุฉ)

### 1. ุฌุฏูู ุงูุชูุงููุงุช (integrations)

```sql
CREATE TABLE integrations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูุชูุงูู
    code VARCHAR(50) NOT NULL,                    -- ููุฏ ูุฑูุฏ (payment_gateway, sms, iot, etc.)
    name_ar VARCHAR(200) NOT NULL,
    name_en VARCHAR(200),
    description TEXT,
    
    -- ุงูููุน ูุงููุฆุฉ
    integration_type VARCHAR(50) NOT NULL,        -- payment, messaging, iot, external_system
    category VARCHAR(50),                         -- local, international
    provider VARCHAR(100),                        -- ุงุณู ุงููุฒูุฏ (acrel, twilio, stripe, etc.)
    
    -- ุงูุฅุนุฏุงุฏุงุช
    base_url VARCHAR(500),
    api_version VARCHAR(20),
    auth_type VARCHAR(50),                        -- api_key, oauth2, basic, hmac
    
    -- ุงูุญุงูุฉ
    is_active BOOLEAN DEFAULT true,
    is_primary BOOLEAN DEFAULT false,             -- ูู ูู ุงููุฒูุฏ ุงูุฃุณุงุณู
    priority INTEGER DEFAULT 1,                   -- ุฃููููุฉ ุงูุงุณุชุฎุฏุงู (ููู fallback)
    
    -- ุงูุตุญุฉ
    last_health_check TIMESTAMP WITH TIME ZONE,
    health_status VARCHAR(20) DEFAULT 'unknown',  -- healthy, degraded, down, unknown
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_by UUID REFERENCES users(id),
    
    UNIQUE(tenant_id, code)
);

CREATE INDEX idx_integrations_tenant ON integrations(tenant_id);
CREATE INDEX idx_integrations_type ON integrations(integration_type);
CREATE INDEX idx_integrations_active ON integrations(is_active);
```

### 2. ุฌุฏูู ุฅุนุฏุงุฏุงุช ุงูุชูุงููุงุช (integration_configs)

```sql
CREATE TABLE integration_configs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    integration_id UUID NOT NULL REFERENCES integrations(id),
    
    -- ุงูููุชุงุญ ูุงููููุฉ
    config_key VARCHAR(100) NOT NULL,
    config_value TEXT,
    is_encrypted BOOLEAN DEFAULT false,           -- ูู ุงููููุฉ ูุดูุฑุฉ
    
    -- ุงูููุน
    value_type VARCHAR(20) DEFAULT 'string',      -- string, number, boolean, json
    
    -- ุงูุจูุฆุฉ
    environment VARCHAR(20) DEFAULT 'production', -- production, staging, development
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(integration_id, config_key, environment)
);

CREATE INDEX idx_integration_configs_integration ON integration_configs(integration_id);
```

### 3. ุฌุฏูู ุณุฌูุงุช ุงูุชูุงููุงุช (integration_logs)

```sql
CREATE TABLE integration_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    integration_id UUID NOT NULL REFERENCES integrations(id),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ุชูุงุตูู ุงูุทูุจ
    request_id VARCHAR(100),                      -- ูุนุฑู ูุฑูุฏ ููุทูุจ
    direction VARCHAR(10) NOT NULL,               -- outgoing, incoming
    method VARCHAR(10),                           -- GET, POST, PUT, DELETE
    endpoint VARCHAR(500),
    
    -- ุงูุจูุงูุงุช
    request_headers JSONB,
    request_body JSONB,
    response_status INTEGER,
    response_headers JSONB,
    response_body JSONB,
    
    -- ุงูุฃุฏุงุก
    duration_ms INTEGER,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) NOT NULL,                  -- success, failed, timeout, error
    error_message TEXT,
    retry_count INTEGER DEFAULT 0,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- ููุชูุณูู
    log_date DATE DEFAULT CURRENT_DATE
) PARTITION BY RANGE (log_date);

CREATE INDEX idx_integration_logs_integration ON integration_logs(integration_id);
CREATE INDEX idx_integration_logs_status ON integration_logs(status);
CREATE INDEX idx_integration_logs_date ON integration_logs(created_at);
```

### 4. ุฌุฏูู ุงูุฃุญุฏุงุซ (events)

```sql
CREATE TABLE events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูุญุฏุซ
    event_type VARCHAR(100) NOT NULL,             -- subscriber.created, invoice.paid, etc.
    event_source VARCHAR(50) NOT NULL,            -- ุงููุธุงู ุงููุตุฏุฑ
    aggregate_type VARCHAR(50),                   -- ููุน ุงูููุงู (customer, invoice, asset)
    aggregate_id UUID,                            -- ูุนุฑู ุงูููุงู
    
    -- ุงูุจูุงูุงุช
    payload JSONB NOT NULL,
    metadata JSONB,                               -- ุจูุงูุงุช ุฅุถุงููุฉ (user_id, ip, etc.)
    
    -- ุงูุชุชุจุน
    correlation_id UUID,                          -- ูุฑุจุท ุงูุฃุญุฏุงุซ ุงููุชุนููุฉ
    causation_id UUID,                            -- ุงูุญุฏุซ ุงูุฐู ุณุจุจ ูุฐุง ุงูุญุฏุซ
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'pending',         -- pending, processing, completed, failed
    processed_at TIMESTAMP WITH TIME ZONE,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- ููุชูุณูู
    event_date DATE DEFAULT CURRENT_DATE
) PARTITION BY RANGE (event_date);

CREATE INDEX idx_events_type ON events(event_type);
CREATE INDEX idx_events_source ON events(event_source);
CREATE INDEX idx_events_aggregate ON events(aggregate_type, aggregate_id);
CREATE INDEX idx_events_status ON events(status);
CREATE INDEX idx_events_correlation ON events(correlation_id);
```

### 5. ุฌุฏูู ุงูุงุดุชุฑุงูุงุช ูู ุงูุฃุญุฏุงุซ (event_subscriptions)

```sql
CREATE TABLE event_subscriptions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูุงุดุชุฑุงู
    subscriber_name VARCHAR(100) NOT NULL,        -- ุงุณู ุงููุดุชุฑู
    event_type VARCHAR(100) NOT NULL,             -- ููุน ุงูุญุฏุซ (ูุฏุนู wildcards: invoice.*)
    
    -- ุงููุฏู
    handler_type VARCHAR(50) NOT NULL,            -- webhook, queue, function
    handler_config JSONB NOT NULL,                -- ุฅุนุฏุงุฏุงุช ุงููุนุงูุฌ
    
    -- ุงูููุชุฑุฉ
    filter_expression JSONB,                      -- ุดุฑูุท ุฅุถุงููุฉ
    
    -- ุงูุฅุนุฏุงุฏุงุช
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0,
    max_retries INTEGER DEFAULT 3,
    retry_delay_seconds INTEGER DEFAULT 60,
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(tenant_id, subscriber_name, event_type)
);

CREATE INDEX idx_event_subscriptions_type ON event_subscriptions(event_type);
CREATE INDEX idx_event_subscriptions_active ON event_subscriptions(is_active);
```

### 6. ุฌุฏูู ุณุฌูุงุช ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ (event_processing_logs)

```sql
CREATE TABLE event_processing_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    event_id UUID NOT NULL REFERENCES events(id),
    subscription_id UUID NOT NULL REFERENCES event_subscriptions(id),
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) NOT NULL,                  -- pending, processing, success, failed
    attempt_number INTEGER DEFAULT 1,
    
    -- ุงููุชูุฌุฉ
    response JSONB,
    error_message TEXT,
    
    -- ุงูุฃุฏุงุก
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    duration_ms INTEGER,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    next_retry_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_event_processing_event ON event_processing_logs(event_id);
CREATE INDEX idx_event_processing_status ON event_processing_logs(status);
CREATE INDEX idx_event_processing_retry ON event_processing_logs(next_retry_at) WHERE status = 'failed';
```

### 7. ุฌุฏูู ููุงุชูุญ API (api_keys)

```sql
CREATE TABLE api_keys (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูููุชุงุญ
    name VARCHAR(200) NOT NULL,
    description TEXT,
    key_prefix VARCHAR(10) NOT NULL,              -- ุฃูู 10 ุฃุญุฑู ููุนุฑุถ
    key_hash VARCHAR(256) NOT NULL,               -- hash ููููุชุงุญ ุงููุงูู
    
    -- ุงูุตูุงุญูุงุช
    scopes JSONB NOT NULL DEFAULT '[]',           -- ูุงุฆูุฉ ุงูุตูุงุญูุงุช
    allowed_ips JSONB,                            -- IPs ุงููุณููุญ ุจูุง (null = ุงููู)
    allowed_origins JSONB,                        -- Origins ุงููุณููุญ ุจูุง
    
    -- ุงูุญุฏูุฏ
    rate_limit_per_minute INTEGER DEFAULT 60,
    rate_limit_per_day INTEGER DEFAULT 10000,
    
    -- ุงูุตูุงุญูุฉ
    expires_at TIMESTAMP WITH TIME ZONE,
    is_active BOOLEAN DEFAULT true,
    
    -- ุงูุงุณุชุฎุฏุงู
    last_used_at TIMESTAMP WITH TIME ZONE,
    usage_count BIGINT DEFAULT 0,
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    revoked_at TIMESTAMP WITH TIME ZONE,
    revoked_by UUID REFERENCES users(id)
);

CREATE INDEX idx_api_keys_tenant ON api_keys(tenant_id);
CREATE INDEX idx_api_keys_prefix ON api_keys(key_prefix);
CREATE INDEX idx_api_keys_active ON api_keys(is_active);
```

### 8. ุฌุฏูู ุณุฌูุงุช ุงุณุชุฎุฏุงู API (api_usage_logs)

```sql
CREATE TABLE api_usage_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    api_key_id UUID REFERENCES api_keys(id),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ุชูุงุตูู ุงูุทูุจ
    method VARCHAR(10) NOT NULL,
    endpoint VARCHAR(500) NOT NULL,
    query_params JSONB,
    
    -- ุงููุตุฏุฑ
    client_ip INET,
    user_agent TEXT,
    origin VARCHAR(500),
    
    -- ุงูุงุณุชุฌุงุจุฉ
    response_status INTEGER,
    response_time_ms INTEGER,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- ููุชูุณูู
    log_date DATE DEFAULT CURRENT_DATE
) PARTITION BY RANGE (log_date);

CREATE INDEX idx_api_usage_key ON api_usage_logs(api_key_id);
CREATE INDEX idx_api_usage_endpoint ON api_usage_logs(endpoint);
CREATE INDEX idx_api_usage_date ON api_usage_logs(created_at);
```

### 9. ุฌุฏูู ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู (rate_limits)

```sql
CREATE TABLE rate_limits (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงููุนุฑู
    identifier_type VARCHAR(50) NOT NULL,         -- api_key, user, ip, tenant
    identifier_value VARCHAR(256) NOT NULL,
    
    -- ุงูุนุฏุงุฏ
    window_start TIMESTAMP WITH TIME ZONE NOT NULL,
    window_size_seconds INTEGER NOT NULL,
    request_count INTEGER DEFAULT 0,
    
    -- ุงูุญุฏ
    max_requests INTEGER NOT NULL,
    
    PRIMARY KEY (identifier_type, identifier_value, window_start)
);

CREATE INDEX idx_rate_limits_identifier ON rate_limits(identifier_type, identifier_value);
CREATE INDEX idx_rate_limits_window ON rate_limits(window_start);
```

### 10. ุฌุฏูู ุณุฌูุงุช ุงููุธุงู (system_logs)

```sql
CREATE TABLE system_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูุณุฌู
    log_level VARCHAR(20) NOT NULL,               -- debug, info, warning, error, critical
    logger_name VARCHAR(200),
    message TEXT NOT NULL,
    
    -- ุงูุณูุงู
    context JSONB,                                -- ุจูุงูุงุช ุฅุถุงููุฉ
    stack_trace TEXT,
    
    -- ุงููุตุฏุฑ
    source_system VARCHAR(50),
    source_service VARCHAR(100),
    source_host VARCHAR(200),
    
    -- ุงููุณุชุฎุฏู
    user_id UUID REFERENCES users(id),
    session_id VARCHAR(100),
    request_id VARCHAR(100),
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- ููุชูุณูู
    log_date DATE DEFAULT CURRENT_DATE
) PARTITION BY RANGE (log_date);

CREATE INDEX idx_system_logs_level ON system_logs(log_level);
CREATE INDEX idx_system_logs_source ON system_logs(source_system);
CREATE INDEX idx_system_logs_date ON system_logs(created_at);
```

### 11. ุฌุฏูู ููุงููุณ ุงูุฃุฏุงุก (performance_metrics)

```sql
CREATE TABLE performance_metrics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    
    -- ุงููููุงุณ
    metric_name VARCHAR(200) NOT NULL,
    metric_type VARCHAR(50) NOT NULL,             -- counter, gauge, histogram, summary
    metric_value DECIMAL(20, 6) NOT NULL,
    
    -- ุงูุชุตูููุงุช
    labels JSONB DEFAULT '{}',
    
    -- ุงููุตุฏุฑ
    source_system VARCHAR(50),
    source_service VARCHAR(100),
    
    -- ุงูุชูููุช
    recorded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- ููุชูุณูู
    metric_date DATE DEFAULT CURRENT_DATE
) PARTITION BY RANGE (metric_date);

CREATE INDEX idx_performance_metrics_name ON performance_metrics(metric_name);
CREATE INDEX idx_performance_metrics_date ON performance_metrics(recorded_at);
```

### 12. ุฌุฏูู ุงูุชูุจููุงุช (system_alerts)

```sql
CREATE TABLE system_alerts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูุชูุจูู
    alert_type VARCHAR(50) NOT NULL,              -- performance, security, system, business
    severity VARCHAR(20) NOT NULL,                -- info, warning, error, critical
    title VARCHAR(500) NOT NULL,
    description TEXT,
    
    -- ุงููุตุฏุฑ
    source_system VARCHAR(50),
    source_rule_id UUID,
    
    -- ุงูุจูุงูุงุช
    alert_data JSONB,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'active',          -- active, acknowledged, resolved, suppressed
    acknowledged_at TIMESTAMP WITH TIME ZONE,
    acknowledged_by UUID REFERENCES users(id),
    resolved_at TIMESTAMP WITH TIME ZONE,
    resolved_by UUID REFERENCES users(id),
    resolution_notes TEXT,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_system_alerts_type ON system_alerts(alert_type);
CREATE INDEX idx_system_alerts_severity ON system_alerts(severity);
CREATE INDEX idx_system_alerts_status ON system_alerts(status);
CREATE INDEX idx_system_alerts_active ON system_alerts(status) WHERE status = 'active';
```

### 13. ุฌุฏูู ููุงุนุฏ ุงูุชูุจููุงุช (alert_rules)

```sql
CREATE TABLE alert_rules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงููุงุนุฏุฉ
    name VARCHAR(200) NOT NULL,
    description TEXT,
    
    -- ุงูุดุฑูุท
    condition_type VARCHAR(50) NOT NULL,          -- threshold, anomaly, pattern
    condition_config JSONB NOT NULL,
    
    -- ุงูุชูุจูู
    alert_type VARCHAR(50) NOT NULL,
    severity VARCHAR(20) NOT NULL,
    title_template VARCHAR(500) NOT NULL,
    description_template TEXT,
    
    -- ุงูุฅุฌุฑุงุกุงุช
    actions JSONB DEFAULT '[]',                   -- ูุงุฆูุฉ ุงูุฅุฌุฑุงุกุงุช (email, sms, webhook)
    
    -- ุงูุฅุนุฏุงุฏุงุช
    is_active BOOLEAN DEFAULT true,
    cooldown_minutes INTEGER DEFAULT 15,          -- ูุชุฑุฉ ุงูุงูุชุธุงุฑ ุจูู ุงูุชูุจููุงุช
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_alert_rules_active ON alert_rules(is_active);
CREATE INDEX idx_alert_rules_type ON alert_rules(alert_type);
```

### 14. ุฌุฏุงูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

```sql
-- ููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
CREATE TABLE ai_models (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงููููุฐุฌ
    name VARCHAR(200) NOT NULL,
    model_type VARCHAR(50) NOT NULL,              -- consumption_forecast, fault_detection, etc.
    version VARCHAR(50) NOT NULL,
    description TEXT,
    
    -- ุงูููู
    model_path VARCHAR(500),
    model_size_bytes BIGINT,
    
    -- ุงูุฃุฏุงุก
    accuracy DECIMAL(5, 4),
    training_date TIMESTAMP WITH TIME ZONE,
    training_samples INTEGER,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'training',        -- training, active, deprecated
    is_active BOOLEAN DEFAULT false,
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id)
);

-- ุชูุจุคุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
CREATE TABLE ai_predictions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    model_id UUID NOT NULL REFERENCES ai_models(id),
    
    -- ููุน ุงูุชูุจุค
    prediction_type VARCHAR(50) NOT NULL,
    target_entity_type VARCHAR(50),
    target_entity_id UUID,
    
    -- ุงูุชูุจุค
    prediction_value JSONB NOT NULL,
    confidence_score DECIMAL(5, 4),
    
    -- ุงููุชุฑุฉ
    prediction_for_date DATE,
    prediction_for_period VARCHAR(50),            -- daily, weekly, monthly
    
    -- ุงูุชุญูู
    actual_value JSONB,
    accuracy DECIMAL(5, 4),
    verified_at TIMESTAMP WITH TIME ZONE,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_ai_predictions_type ON ai_predictions(prediction_type);
CREATE INDEX idx_ai_predictions_date ON ai_predictions(prediction_for_date);
CREATE INDEX idx_ai_predictions_entity ON ai_predictions(target_entity_type, target_entity_id);

-- ุจูุงูุงุช ุงูุชุฏุฑูุจ
CREATE TABLE ai_training_data (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    model_type VARCHAR(50) NOT NULL,
    
    -- ุงูุจูุงูุงุช
    feature_data JSONB NOT NULL,
    label_data JSONB,
    
    -- ุงููุตุฏุฑ
    source_system VARCHAR(50),
    source_entity_type VARCHAR(50),
    source_entity_id UUID,
    
    -- ุงูุฌูุฏุฉ
    quality_score DECIMAL(5, 4),
    is_validated BOOLEAN DEFAULT false,
    
    -- ุงูุชูููุช
    data_timestamp TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_ai_training_type ON ai_training_data(model_type);
CREATE INDEX idx_ai_training_date ON ai_training_data(data_timestamp);
```

### 15. ุฌุฏูู Webhooks ุงูุตุงุฏุฑุฉ (outgoing_webhooks)

```sql
CREATE TABLE outgoing_webhooks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- ูุนูููุงุช ุงูู Webhook
    name VARCHAR(200) NOT NULL,
    description TEXT,
    url VARCHAR(500) NOT NULL,
    
    -- ุงูุฃุญุฏุงุซ
    subscribed_events JSONB NOT NULL DEFAULT '[]',
    
    -- ุงูุฃูุงู
    secret_key VARCHAR(256),                      -- ููุชูููุน
    headers JSONB,                                -- headers ุฅุถุงููุฉ
    
    -- ุงูุฅุนุฏุงุฏุงุช
    is_active BOOLEAN DEFAULT true,
    timeout_seconds INTEGER DEFAULT 30,
    max_retries INTEGER DEFAULT 3,
    
    -- ุงูุญุงูุฉ
    last_triggered_at TIMESTAMP WITH TIME ZONE,
    last_status VARCHAR(20),
    consecutive_failures INTEGER DEFAULT 0,
    
    -- ุงูุชุฏููู
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_outgoing_webhooks_active ON outgoing_webhooks(is_active);

-- ุณุฌู ุชุณููู Webhooks
CREATE TABLE webhook_deliveries (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    webhook_id UUID NOT NULL REFERENCES outgoing_webhooks(id),
    event_id UUID REFERENCES events(id),
    
    -- ุงูุทูุจ
    request_url VARCHAR(500) NOT NULL,
    request_headers JSONB,
    request_body JSONB,
    
    -- ุงูุงุณุชุฌุงุจุฉ
    response_status INTEGER,
    response_headers JSONB,
    response_body TEXT,
    
    -- ุงูุฃุฏุงุก
    duration_ms INTEGER,
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) NOT NULL,                  -- pending, success, failed
    attempt_number INTEGER DEFAULT 1,
    error_message TEXT,
    
    -- ุงูุชูููุช
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    next_retry_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_webhook_deliveries_webhook ON webhook_deliveries(webhook_id);
CREATE INDEX idx_webhook_deliveries_status ON webhook_deliveries(status);
CREATE INDEX idx_webhook_deliveries_retry ON webhook_deliveries(next_retry_at) WHERE status = 'failed';
```

---

## ๐ APIs ุงูุชูุตูููุฉ ููู ูุธุงู

### 1. APIs ุงููุธุงู ุงูุฃู (`/api/core/*`)

```
# === ุงููุณุชุฃุฌุฑูู ===
GET    /api/core/tenants                    - ูุงุฆูุฉ ุงููุณุชุฃุฌุฑูู
GET    /api/core/tenants/:id                - ุชูุงุตูู ูุณุชุฃุฌุฑ
POST   /api/core/tenants                    - ุฅูุดุงุก ูุณุชุฃุฌุฑ
PUT    /api/core/tenants/:id                - ุชุนุฏูู ูุณุชุฃุฌุฑ
GET    /api/core/tenants/:id/settings       - ุฅุนุฏุงุฏุงุช ุงููุณุชุฃุฌุฑ

# === ุงููุณุชุฎุฏููู ===
GET    /api/core/users                      - ูุงุฆูุฉ ุงููุณุชุฎุฏููู
GET    /api/core/users/:id                  - ุชูุงุตูู ูุณุชุฎุฏู
POST   /api/core/users                      - ุฅูุดุงุก ูุณุชุฎุฏู
PUT    /api/core/users/:id                  - ุชุนุฏูู ูุณุชุฎุฏู
DELETE /api/core/users/:id                  - ุญุฐู ูุณุชุฎุฏู
POST   /api/core/users/:id/activate         - ุชูุนูู ูุณุชุฎุฏู
POST   /api/core/users/:id/deactivate       - ุชุนุทูู ูุณุชุฎุฏู
PUT    /api/core/users/:id/password         - ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

# === ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช ===
GET    /api/core/roles                      - ูุงุฆูุฉ ุงูุฃุฏูุงุฑ
GET    /api/core/roles/:id                  - ุชูุงุตูู ุฏูุฑ
POST   /api/core/roles                      - ุฅูุดุงุก ุฏูุฑ
PUT    /api/core/roles/:id                  - ุชุนุฏูู ุฏูุฑ
GET    /api/core/permissions                - ูุงุฆูุฉ ุงูุตูุงุญูุงุช
POST   /api/core/users/:id/roles            - ุฅุณูุงุฏ ุฃุฏูุงุฑ ูููุณุชุฎุฏู

# === ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ===
GET    /api/core/accounts                   - ูุงุฆูุฉ ุงูุญุณุงุจุงุช
GET    /api/core/accounts/tree              - ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
GET    /api/core/accounts/:id               - ุชูุงุตูู ุญุณุงุจ
POST   /api/core/accounts                   - ุฅูุดุงุก ุญุณุงุจ
PUT    /api/core/accounts/:id               - ุชุนุฏูู ุญุณุงุจ
GET    /api/core/accounts/:id/balance       - ุฑุตูุฏ ุงูุญุณุงุจ
GET    /api/core/accounts/:id/transactions  - ุญุฑูุงุช ุงูุญุณุงุจ

# === ุงููููุฏ ุงููุญุงุณุจูุฉ ===
GET    /api/core/journal-entries            - ูุงุฆูุฉ ุงููููุฏ
GET    /api/core/journal-entries/:id        - ุชูุงุตูู ููุฏ
POST   /api/core/journal-entries            - ุฅูุดุงุก ููุฏ
POST   /api/core/journal-entries/:id/post   - ุชุฑุญูู ููุฏ
POST   /api/core/journal-entries/:id/reverse - ุนูุณ ููุฏ

# === ุงููุชุฑุงุช ุงููุญุงุณุจูุฉ ===
GET    /api/core/periods                    - ูุงุฆูุฉ ุงููุชุฑุงุช
POST   /api/core/periods/:id/close          - ุฅุบูุงู ูุชุฑุฉ
POST   /api/core/periods/:id/reopen         - ุฅุนุงุฏุฉ ูุชุญ ูุชุฑุฉ

# === ูุญุฑู ุงูุชุณููุฉ ===
GET    /api/core/reconciliation/sessions    - ุฌูุณุงุช ุงูุชุณููุฉ
POST   /api/core/reconciliation/sessions    - ุฅูุดุงุก ุฌูุณุฉ
GET    /api/core/reconciliation/baskets     - ุณูุงุช ุงูุชุณููุฉ
POST   /api/core/reconciliation/match       - ุชูููุฐ ุงููุทุงุจูุฉ
```

### 2. APIs ุงูุนูููุงุช ุงูููุฏุงููุฉ (`/api/field/*`)

```
# === ุฃูุงูุฑ ุงูุนูู ===
GET    /api/field/work-orders               - ูุงุฆูุฉ ุฃูุงูุฑ ุงูุนูู
GET    /api/field/work-orders/:id           - ุชูุงุตูู ุฃูุฑ ุนูู
POST   /api/field/work-orders               - ุฅูุดุงุก ุฃูุฑ ุนูู
PUT    /api/field/work-orders/:id           - ุชุนุฏูู ุฃูุฑ ุนูู
POST   /api/field/work-orders/:id/assign    - ุฅุณูุงุฏ ุฃูุฑ ุนูู
POST   /api/field/work-orders/:id/start     - ุจุฏุก ุงูุชูููุฐ
POST   /api/field/work-orders/:id/complete  - ุฅููุงู ุฃูุฑ ุงูุนูู
POST   /api/field/work-orders/:id/cancel    - ุฅูุบุงุก ุฃูุฑ ุงูุนูู

# === ุงููุฑู ุงูููุฏุงููุฉ ===
GET    /api/field/teams                     - ูุงุฆูุฉ ุงููุฑู
GET    /api/field/teams/:id                 - ุชูุงุตูู ูุฑูู
GET    /api/field/teams/:id/members         - ุฃุนุถุงุก ุงููุฑูู
GET    /api/field/teams/:id/location        - ูููุน ุงููุฑูู ุงูุญุงูู
GET    /api/field/teams/:id/schedule        - ุฌุฏูู ุงููุฑูู

# === ุชุทุจูู ุงูุฌูุงู ===
POST   /api/field/mobile/check-in           - ุชุณุฌูู ุงูุญุถูุฑ
POST   /api/field/mobile/check-out          - ุชุณุฌูู ุงูุงูุตุฑุงู
POST   /api/field/mobile/location           - ุชุญุฏูุซ ุงููููุน
GET    /api/field/mobile/my-tasks           - ููุงูู
POST   /api/field/mobile/tasks/:id/photos   - ุฑูุน ุตูุฑ
POST   /api/field/mobile/tasks/:id/notes    - ุฅุถุงูุฉ ููุงุญุธุงุช

# === ููุตุฉ ุงูุฏุฑุฏุดุฉ ===
GET    /api/field/chat/conversations        - ูุงุฆูุฉ ุงููุญุงุฏุซุงุช
POST   /api/field/chat/conversations        - ุฅูุดุงุก ูุญุงุฏุซุฉ
GET    /api/field/chat/conversations/:id/messages - ุงูุฑุณุงุฆู
POST   /api/field/chat/messages             - ุฅุฑุณุงู ุฑุณุงูุฉ
PUT    /api/field/chat/messages/:id/read    - ุชุนููู ูููุฑูุก
```

### 3. APIs ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ (`/api/hr/*`)

```
# === ุงูููุธููู ===
GET    /api/hr/employees                    - ูุงุฆูุฉ ุงูููุธููู
GET    /api/hr/employees/:id                - ุชูุงุตูู ููุธู
POST   /api/hr/employees                    - ุฅุถุงูุฉ ููุธู
PUT    /api/hr/employees/:id                - ุชุนุฏูู ููุธู
GET    /api/hr/employees/:id/documents      - ูุณุชูุฏุงุช ุงูููุธู

# === ุงูุญุถูุฑ ===
POST   /api/hr/attendance/punch             - ุงุณุชูุจุงู ุจูุงูุงุช ุงูุจุตูุฉ
GET    /api/hr/attendance/daily/:date       - ุณุฌู ุงูุญุถูุฑ ุงููููู
GET    /api/hr/attendance/employee/:id      - ุณุฌู ููุธู ูุญุฏุฏ
GET    /api/hr/attendance/report/monthly    - ุงูุชูุฑูุฑ ุงูุดูุฑู

# === ุงูุฑูุงุชุจ ===
GET    /api/hr/payroll                      - ูุงุฆูุฉ ูุณูุฑุงุช ุงูุฑูุงุชุจ
POST   /api/hr/payroll                      - ุฅูุดุงุก ูุณูุฑ
POST   /api/hr/payroll/:id/calculate        - ุญุณุงุจ ุงูุฑูุงุชุจ
POST   /api/hr/payroll/:id/approve          - ุงุนุชูุงุฏ ุงููุณูุฑ
GET    /api/hr/payroll/:id/slips            - ูุณุงุฆู ุงูุฑูุงุชุจ

# === ุงูุฅุฌุงุฒุงุช ===
GET    /api/hr/leaves                       - ูุงุฆูุฉ ุทูุจุงุช ุงูุฅุฌุงุฒุงุช
POST   /api/hr/leaves                       - ุชูุฏูู ุทูุจ ุฅุฌุงุฒุฉ
PUT    /api/hr/leaves/:id/approve           - ุงูููุงููุฉ
PUT    /api/hr/leaves/:id/reject            - ุงูุฑูุถ
GET    /api/hr/employees/:id/leave-balance  - ุฑุตูุฏ ุงูุฅุฌุงุฒุงุช

# === ุฃุฌูุฒุฉ ุงูุจุตูุฉ ===
GET    /api/hr/devices/biometric            - ูุงุฆูุฉ ุงูุฃุฌูุฒุฉ
POST   /api/hr/devices/biometric/:id/sync   - ูุฒุงููุฉ ุฌูุงุฒ
GET    /api/hr/devices/biometric/:id/status - ุญุงูุฉ ุงูุฌูุงุฒ
```

### 4. APIs ุงูุชูุงุฑูุฑ (`/api/reports/*`)

```
# === ุงูุชูุงุฑูุฑ ุงูุนุงูุฉ ===
GET    /api/reports                         - ูุงุฆูุฉ ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ
GET    /api/reports/:code                   - ุชุนุฑูู ุชูุฑูุฑ
POST   /api/reports/:code/generate          - ุชูููุฏ ุชูุฑูุฑ
GET    /api/reports/:code/preview           - ูุนุงููุฉ ุชูุฑูุฑ
GET    /api/reports/logs                    - ุณุฌู ุงูุชูุงุฑูุฑ

# === ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ ===
GET    /api/reports/scheduled               - ูุงุฆูุฉ ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ
POST   /api/reports/scheduled               - ุฅูุดุงุก ุชูุฑูุฑ ูุฌุฏูู
PUT    /api/reports/scheduled/:id           - ุชุนุฏูู
DELETE /api/reports/scheduled/:id           - ุญุฐู
POST   /api/reports/scheduled/:id/run       - ุชุดุบูู ููุฑู

# === ููุญุงุช ุงูุชุญูู ===
GET    /api/reports/dashboards/executive    - ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนููุง
GET    /api/reports/dashboards/station/:id  - ููุญุฉ ูุฏูุฑ ุงููุญุทุฉ
GET    /api/reports/dashboards/operations   - ููุญุฉ ุงูุนูููุงุช
```

### 5. APIs ุงูุชุฎุทูุท ูุงููุดุงุฑูุน (`/api/projects/*`)

```
# === ุงููุดุงุฑูุน ===
GET    /api/projects                        - ูุงุฆูุฉ ุงููุดุงุฑูุน
GET    /api/projects/:id                    - ุชูุงุตูู ูุดุฑูุน
POST   /api/projects                        - ุฅูุดุงุก ูุดุฑูุน
PUT    /api/projects/:id                    - ุชุนุฏูู ูุดุฑูุน
GET    /api/projects/:id/progress           - ุชูุฏู ุงููุดุฑูุน
GET    /api/projects/:id/budget             - ููุฒุงููุฉ ุงููุดุฑูุน

# === ุงูููุงู ===
GET    /api/projects/:id/tasks              - ููุงู ุงููุดุฑูุน
POST   /api/projects/:id/tasks              - ุฅูุดุงุก ูููุฉ
PUT    /api/projects/tasks/:id              - ุชุนุฏูู ูููุฉ
PUT    /api/projects/tasks/:id/status       - ุชุญุฏูุซ ุญุงูุฉ ุงููููุฉ

# === ุงูููุงุฑุฏ ===
GET    /api/projects/:id/resources          - ููุงุฑุฏ ุงููุดุฑูุน
POST   /api/projects/:id/resources          - ุชุฎุตูุต ููุฑุฏ
GET    /api/projects/:id/materials          - ููุงุฏ ุงููุดุฑูุน
```

---

## ๐ค ูุญุฏุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุงูุชูุตูููุฉ)

### 1. ุงูุชูุจุค ุจุงูุงุณุชููุงู

```sql
-- ุฏุงูุฉ ุงูุชูุจุค ุจุงูุงุณุชููุงู
CREATE OR REPLACE FUNCTION ai_predict_consumption(
    p_tenant_id UUID,
    p_target_type VARCHAR(50),      -- station, cable, customer
    p_target_id UUID,
    p_prediction_date DATE,
    p_period VARCHAR(20)            -- hourly, daily, weekly, monthly
)
RETURNS JSONB AS $$
DECLARE
    v_model_id UUID;
    v_prediction JSONB;
    v_historical_data JSONB;
    v_weather_data JSONB;
BEGIN
    -- 1. ุฌูุจ ุงููููุฐุฌ ุงููุดุท
    SELECT id INTO v_model_id
    FROM ai_models
    WHERE tenant_id = p_tenant_id
      AND model_type = 'consumption_forecast'
      AND is_active = true
    ORDER BY training_date DESC
    LIMIT 1;
    
    -- 2. ุฌูุน ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
    SELECT jsonb_agg(jsonb_build_object(
        'date', reading_date,
        'consumption', consumption_kwh
    )) INTO v_historical_data
    FROM meter_readings
    WHERE tenant_id = p_tenant_id
      AND reading_date >= p_prediction_date - INTERVAL '1 year';
    
    -- 3. ุชูููุฐ ุงูุชูุจุค (placeholder ูููููุฐุฌ ุงููุนูู)
    v_prediction := jsonb_build_object(
        'predicted_consumption', 0,
        'confidence', 0.85,
        'lower_bound', 0,
        'upper_bound', 0
    );
    
    -- 4. ุญูุธ ุงูุชูุจุค
    INSERT INTO ai_predictions (
        tenant_id, model_id, prediction_type,
        target_entity_type, target_entity_id,
        prediction_value, confidence_score,
        prediction_for_date, prediction_for_period
    ) VALUES (
        p_tenant_id, v_model_id, 'consumption',
        p_target_type, p_target_id,
        v_prediction, (v_prediction->>'confidence')::DECIMAL,
        p_prediction_date, p_period
    );
    
    RETURN v_prediction;
END;
$$ LANGUAGE plpgsql;
```

### 2. ูุดู ุงูุฃุนุทุงู

```sql
-- ุฏุงูุฉ ูุดู ุงูุฃุนุทุงู
CREATE OR REPLACE FUNCTION ai_detect_anomalies(
    p_tenant_id UUID,
    p_asset_type VARCHAR(50),
    p_asset_id UUID
)
RETURNS JSONB AS $$
DECLARE
    v_anomalies JSONB := '[]';
    v_reading RECORD;
    v_avg_value DECIMAL;
    v_std_dev DECIMAL;
BEGIN
    -- 1. ุญุณุงุจ ุงููุชูุณุท ูุงูุงูุญุฑุงู ุงููุนูุงุฑู
    SELECT 
        AVG(reading_value) as avg_val,
        STDDEV(reading_value) as std_val
    INTO v_avg_value, v_std_dev
    FROM asset_readings
    WHERE tenant_id = p_tenant_id
      AND asset_id = p_asset_id
      AND reading_date >= NOW() - INTERVAL '30 days';
    
    -- 2. ุงูุจุญุซ ุนู ุงูููู ุงูุดุงุฐุฉ
    FOR v_reading IN
        SELECT *
        FROM asset_readings
        WHERE tenant_id = p_tenant_id
          AND asset_id = p_asset_id
          AND reading_date >= NOW() - INTERVAL '24 hours'
          AND ABS(reading_value - v_avg_value) > (3 * v_std_dev)
    LOOP
        v_anomalies := v_anomalies || jsonb_build_object(
            'reading_id', v_reading.id,
            'reading_date', v_reading.reading_date,
            'value', v_reading.reading_value,
            'deviation', ABS(v_reading.reading_value - v_avg_value) / v_std_dev,
            'severity', CASE 
                WHEN ABS(v_reading.reading_value - v_avg_value) > (5 * v_std_dev) THEN 'critical'
                WHEN ABS(v_reading.reading_value - v_avg_value) > (4 * v_std_dev) THEN 'high'
                ELSE 'medium'
            END
        );
    END LOOP;
    
    RETURN jsonb_build_object(
        'anomalies', v_anomalies,
        'count', jsonb_array_length(v_anomalies),
        'analysis_period', '24 hours',
        'baseline_period', '30 days'
    );
END;
$$ LANGUAGE plpgsql;
```

### 3. ุชุญุณูู ุงูุชูุฒูุน

```sql
-- ุฏุงูุฉ ุชุญุณูู ุชูุฒูุน ุงูุฃุญูุงู
CREATE OR REPLACE FUNCTION ai_optimize_load_distribution(
    p_tenant_id UUID,
    p_station_ids UUID[]
)
RETURNS JSONB AS $$
DECLARE
    v_station RECORD;
    v_recommendations JSONB := '[]';
    v_total_capacity DECIMAL := 0;
    v_total_load DECIMAL := 0;
BEGIN
    -- 1. ุฌูุน ุจูุงูุงุช ุงููุญุทุงุช
    FOR v_station IN
        SELECT 
            s.id,
            s.name,
            s.capacity_kw,
            COALESCE(SUM(mr.consumption_kwh), 0) as current_load
        FROM stations s
        LEFT JOIN meter_readings mr ON mr.station_id = s.id
            AND mr.reading_date >= NOW() - INTERVAL '1 hour'
        WHERE s.tenant_id = p_tenant_id
          AND s.id = ANY(p_station_ids)
        GROUP BY s.id, s.name, s.capacity_kw
    LOOP
        v_total_capacity := v_total_capacity + v_station.capacity_kw;
        v_total_load := v_total_load + v_station.current_load;
        
        -- 2. ุชุญููู ูู ูุญุทุฉ
        IF v_station.current_load > v_station.capacity_kw * 0.9 THEN
            v_recommendations := v_recommendations || jsonb_build_object(
                'station_id', v_station.id,
                'station_name', v_station.name,
                'type', 'overload_warning',
                'current_load_percent', ROUND((v_station.current_load / v_station.capacity_kw * 100)::NUMERIC, 2),
                'recommendation', 'ุชุญููู ุฌุฒุก ูู ุงูุญูู ุฅูู ูุญุทุฉ ุฃุฎุฑู'
            );
        ELSIF v_station.current_load < v_station.capacity_kw * 0.3 THEN
            v_recommendations := v_recommendations || jsonb_build_object(
                'station_id', v_station.id,
                'station_name', v_station.name,
                'type', 'underutilized',
                'current_load_percent', ROUND((v_station.current_load / v_station.capacity_kw * 100)::NUMERIC, 2),
                'recommendation', 'ูููู ุงุณุชูุจุงู ุญูู ุฅุถุงูู'
            );
        END IF;
    END LOOP;
    
    RETURN jsonb_build_object(
        'total_capacity_kw', v_total_capacity,
        'total_load_kw', v_total_load,
        'utilization_percent', ROUND((v_total_load / v_total_capacity * 100)::NUMERIC, 2),
        'recommendations', v_recommendations
    );
END;
$$ LANGUAGE plpgsql;
```

---

## ๐ APIs ุงูุฐูุงุก ุงูุงุตุทูุงุนู

```
# === ุงูุชูุจุคุงุช ===
POST   /api/ai/predict/consumption          - ุงูุชูุจุค ุจุงูุงุณุชููุงู
POST   /api/ai/predict/demand               - ุงูุชูุจุค ุจุงูุทูุจ
POST   /api/ai/predict/maintenance          - ุงูุชูุจุค ุจุงูุตูุงูุฉ

# === ุงููุดู ===
POST   /api/ai/detect/anomalies             - ูุดู ุงูุญุงูุงุช ุงูุดุงุฐุฉ
POST   /api/ai/detect/fraud                 - ูุดู ุงูุงุญุชูุงู
POST   /api/ai/detect/faults                - ูุดู ุงูุฃุนุทุงู

# === ุงูุชุญุณูู ===
POST   /api/ai/optimize/distribution        - ุชุญุณูู ุงูุชูุฒูุน
POST   /api/ai/optimize/scheduling          - ุชุญุณูู ุงูุฌุฏููุฉ

# === ุงูุชุญููู ===
GET    /api/ai/analysis/consumption-patterns - ุฃููุงุท ุงูุงุณุชููุงู
GET    /api/ai/analysis/customer-segments   - ุชุตููู ุงูุนููุงุก

# === ุงูููุงุฐุฌ ===
GET    /api/ai/models                       - ูุงุฆูุฉ ุงูููุงุฐุฌ
POST   /api/ai/models/:id/train             - ุชุฏุฑูุจ ูููุฐุฌ
GET    /api/ai/models/:id/metrics           - ููุงููุณ ุฃุฏุงุก ุงููููุฐุฌ
```

---

## ๐ก Triggers ููุชูุงูู ุงูุชููุงุฆู

```sql
-- Trigger ููุดุฑ ุงูุฃุญุฏุงุซ ุชููุงุฆูุงู
CREATE OR REPLACE FUNCTION publish_event()
RETURNS TRIGGER AS $$
DECLARE
    v_event_type VARCHAR(100);
    v_payload JSONB;
BEGIN
    -- ุชุญุฏูุฏ ููุน ุงูุญุฏุซ
    v_event_type := TG_ARGV[0] || '.' || LOWER(TG_OP);
    
    -- ุจูุงุก ุงูู payload
    IF TG_OP = 'DELETE' THEN
        v_payload := to_jsonb(OLD);
    ELSE
        v_payload := to_jsonb(NEW);
    END IF;
    
    -- ุฅุฏุฑุงุฌ ุงูุญุฏุซ
    INSERT INTO events (
        tenant_id,
        event_type,
        event_source,
        aggregate_type,
        aggregate_id,
        payload
    ) VALUES (
        COALESCE(NEW.tenant_id, OLD.tenant_id),
        v_event_type,
        TG_TABLE_NAME,
        TG_ARGV[0],
        COALESCE(NEW.id, OLD.id),
        v_payload
    );
    
    RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

-- ุชุทุจูู ุนูู ุฌุฏุงูู ูุฎุชููุฉ
CREATE TRIGGER trg_customer_events
    AFTER INSERT OR UPDATE OR DELETE ON customers
    FOR EACH ROW EXECUTE FUNCTION publish_event('customer');

CREATE TRIGGER trg_invoice_events
    AFTER INSERT OR UPDATE OR DELETE ON invoices
    FOR EACH ROW EXECUTE FUNCTION publish_event('invoice');

CREATE TRIGGER trg_payment_events
    AFTER INSERT OR UPDATE ON payments
    FOR EACH ROW EXECUTE FUNCTION publish_event('payment');

CREATE TRIGGER trg_asset_events
    AFTER INSERT OR UPDATE ON assets
    FOR EACH ROW EXECUTE FUNCTION publish_event('asset');

CREATE TRIGGER trg_work_order_events
    AFTER INSERT OR UPDATE ON work_orders
    FOR EACH ROW EXECUTE FUNCTION publish_event('work_order');
```

---

## ๐ ุงูุชูุงูู ูุน ูู ูุธุงู (ููุฎุต)

| ุงููุธุงู | APIs | ุงูุฃุญุฏุงุซ ุงูููุดูุฑุฉ | ุงูุฃุญุฏุงุซ ุงููุณุชูุจูุฉ |
|--------|------|-----------------|-------------------|
| ุงููุธุงู ุงูุฃู (01) | `/api/core/*` | user.*, account.*, journal.* | - |
| ุงูุฃุตูู ูุงูุตูุงูุฉ (03) | `/api/assets/*`, `/api/maintenance/*` | asset.*, maintenance.* | invoice.paid |
| ุงูุนูููุงุช ุงูููุฏุงููุฉ (04) | `/api/field/*` | work_order.*, team.* | asset.fault_detected |
| ุงููุฑุงูุจุฉ ูุงูุชุญูู (05) | `/api/scada/*` | network.*, alert.* | - |
| ุงููุฎุฒูู ูุงููุดุชุฑูุงุช (06) | `/api/inventory/*` | inventory.*, purchase.* | work_order.completed |
| ุงูุนููุงุก ูุงูููุชุฑุฉ (07) | `/api/billing/*` | customer.*, invoice.*, payment.* | meter.reading |
| ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ (08) | `/api/hr/*` | employee.*, payroll.* | - |
| ุงูุชูุงุฑูุฑ (09) | `/api/reports/*` | report.generated | * (ูุณุชูุน ููู ุงูุฃุญุฏุงุซ) |
| ุงูุชุฎุทูุท ูุงููุดุงุฑูุน (10) | `/api/projects/*` | project.*, task.* | asset.installed |


---

# ๐ก APIs ุงูุฃูุธูุฉ ุงูุฅุถุงููุฉ

## 6. APIs ุงูุฃุตูู ูุงูุตูุงูุฉ (`/api/assets/*`)

```
# === ุงูุฃุตูู ===
GET    /api/assets/                          - ูุงุฆูุฉ ุงูุฃุตูู
GET    /api/assets/:id                       - ุชูุงุตูู ุฃุตู
POST   /api/assets/                          - ุฅูุดุงุก ุฃุตู
PUT    /api/assets/:id                       - ุชุนุฏูู ุฃุตู
DELETE /api/assets/:id                       - ุญุฐู ุฃุตู
GET    /api/assets/:id/history               - ุชุงุฑูุฎ ุงูุฃุตู
GET    /api/assets/:id/depreciation          - ุฌุฏูู ุงูุฅููุงู
POST   /api/assets/:id/depreciation/run      - ุชุดุบูู ุงูุฅููุงู
GET    /api/assets/categories                - ูุฆุงุช ุงูุฃุตูู
GET    /api/assets/by-station/:station_id    - ุฃุตูู ุงููุญุทุฉ
GET    /api/assets/expiring                  - ุฃุตูู ุชูุชูู ูุฑูุจุงู

# === ุงูุตูุงูุฉ ===
GET    /api/maintenance/schedules            - ุฌุฏุงูู ุงูุตูุงูุฉ
POST   /api/maintenance/schedules            - ุฅูุดุงุก ุฌุฏูู ุตูุงูุฉ
GET    /api/maintenance/schedules/:id        - ุชูุงุตูู ุฌุฏูู
PUT    /api/maintenance/schedules/:id        - ุชุนุฏูู ุฌุฏูู
DELETE /api/maintenance/schedules/:id        - ุญุฐู ุฌุฏูู
GET    /api/maintenance/upcoming             - ุงูุตูุงูุฉ ุงููุงุฏูุฉ
POST   /api/maintenance/work-orders          - ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ
GET    /api/maintenance/work-orders/:id      - ุชูุงุตูู ุฃูุฑ ุงูุตูุงูุฉ
PUT    /api/maintenance/work-orders/:id/complete - ุฅููุงู ุฃูุฑ ุงูุตูุงูุฉ

# === ูุทุน ุงูุบูุงุฑ ===
GET    /api/assets/:id/spare-parts           - ูุทุน ุบูุงุฑ ุงูุฃุตู
POST   /api/assets/:id/spare-parts           - ุฑุจุท ูุทุนุฉ ุบูุงุฑ
GET    /api/spare-parts/low-stock            - ูุทุน ุบูุงุฑ ููุฎูุถุฉ
```

## 7. APIs ุงููุฎุฒูู ูุงููุดุชุฑูุงุช (`/api/inventory/*`)

```
# === ุงููุฎุฒูู ===
GET    /api/inventory/items                  - ูุงุฆูุฉ ุงูุฃุตูุงู
GET    /api/inventory/items/:id              - ุชูุงุตูู ุตูู
POST   /api/inventory/items                  - ุฅูุดุงุก ุตูู
PUT    /api/inventory/items/:id              - ุชุนุฏูู ุตูู
GET    /api/inventory/items/:id/movements    - ุญุฑูุงุช ุงูุตูู
GET    /api/inventory/items/:id/stock        - ุฑุตูุฏ ุงูุตูู
GET    /api/inventory/low-stock              - ุฃุตูุงู ุชุญุช ุงูุญุฏ
GET    /api/inventory/warehouses             - ูุงุฆูุฉ ุงููุณุชูุฏุนุงุช
GET    /api/inventory/warehouses/:id/stock   - ุฑุตูุฏ ุงููุณุชูุฏุน

# === ุงูุตุฑู ูุงูุงุณุชูุงู ===
POST   /api/inventory/receive                - ุงุณุชูุงู ุจุถุงุนุฉ
POST   /api/inventory/issue                  - ุตุฑู ุจุถุงุนุฉ
POST   /api/inventory/transfer               - ุชุญููู ุจูู ูุณุชูุฏุนุงุช
POST   /api/inventory/adjust                 - ุชุณููุฉ ูุฎุฒูู
GET    /api/inventory/transactions           - ุญุฑูุงุช ุงููุฎุฒูู

# === ุงููุดุชุฑูุงุช ===
GET    /api/procurement/purchase-requests    - ุทูุจุงุช ุงูุดุฑุงุก
POST   /api/procurement/purchase-requests    - ุฅูุดุงุก ุทูุจ ุดุฑุงุก
GET    /api/procurement/purchase-requests/:id - ุชูุงุตูู ุทูุจ
PUT    /api/procurement/purchase-requests/:id/approve - ููุงููุฉ
GET    /api/procurement/purchase-orders      - ุฃูุงูุฑ ุงูุดุฑุงุก
POST   /api/procurement/purchase-orders      - ุฅูุดุงุก ุฃูุฑ ุดุฑุงุก
GET    /api/procurement/purchase-orders/:id  - ุชูุงุตูู ุฃูุฑ ุงูุดุฑุงุก
PUT    /api/procurement/purchase-orders/:id/receive - ุงุณุชูุงู
GET    /api/procurement/rfqs                 - ุทูุจุงุช ุนุฑูุถ ุงูุฃุณุนุงุฑ
POST   /api/procurement/rfqs                 - ุฅูุดุงุก ุทูุจ ุนุฑุถ ุณุนุฑ

# === ุงูููุฑุฏูู ===
GET    /api/procurement/suppliers            - ูุงุฆูุฉ ุงูููุฑุฏูู
GET    /api/procurement/suppliers/:id        - ุชูุงุตูู ููุฑุฏ
POST   /api/procurement/suppliers            - ุฅูุดุงุก ููุฑุฏ
PUT    /api/procurement/suppliers/:id        - ุชุนุฏูู ููุฑุฏ
GET    /api/procurement/suppliers/:id/orders - ุฃูุงูุฑ ุงูููุฑุฏ
GET    /api/procurement/suppliers/:id/rating - ุชูููู ุงูููุฑุฏ
```

## 8. APIs ุงูุนููุงุก ูุงูููุชุฑุฉ (`/api/billing/*`)

```
# === ุงูุนููุงุก ===
GET    /api/billing/customers                - ูุงุฆูุฉ ุงูุนููุงุก
GET    /api/billing/customers/:id            - ุชูุงุตูู ุนููู
POST   /api/billing/customers                - ุฅูุดุงุก ุนููู
PUT    /api/billing/customers/:id            - ุชุนุฏูู ุนููู
GET    /api/billing/customers/:id/meters     - ุนุฏุงุฏุงุช ุงูุนููู
GET    /api/billing/customers/:id/invoices   - ููุงุชูุฑ ุงูุนููู
GET    /api/billing/customers/:id/payments   - ูุฏููุนุงุช ุงูุนููู
GET    /api/billing/customers/:id/balance    - ุฑุตูุฏ ุงูุนููู
GET    /api/billing/customers/:id/statement  - ูุดู ุญุณุงุจ ุงูุนููู

# === ุงูุนุฏุงุฏุงุช ===
GET    /api/billing/meters                   - ูุงุฆูุฉ ุงูุนุฏุงุฏุงุช
GET    /api/billing/meters/:id               - ุชูุงุตูู ุนุฏุงุฏ
POST   /api/billing/meters                   - ุฅูุดุงุก ุนุฏุงุฏ
PUT    /api/billing/meters/:id               - ุชุนุฏูู ุนุฏุงุฏ
GET    /api/billing/meters/:id/readings      - ูุฑุงุกุงุช ุงูุนุฏุงุฏ
POST   /api/billing/meters/:id/readings      - ุฅุถุงูุฉ ูุฑุงุกุฉ
GET    /api/billing/meters/:id/consumption   - ุงุณุชููุงู ุงูุนุฏุงุฏ

# === ุงูููุชุฑุฉ ===
GET    /api/billing/invoices                 - ูุงุฆูุฉ ุงูููุงุชูุฑ
GET    /api/billing/invoices/:id             - ุชูุงุตูู ูุงุชูุฑุฉ
POST   /api/billing/invoices/generate        - ุชูููุฏ ุงูููุงุชูุฑ
POST   /api/billing/invoices/:id/send        - ุฅุฑุณุงู ุงููุงุชูุฑุฉ
GET    /api/billing/invoices/unpaid          - ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ
GET    /api/billing/invoices/overdue         - ุงูููุงุชูุฑ ุงููุชุฃุฎุฑุฉ

# === ุงููุฏููุนุงุช ===
GET    /api/billing/payments                 - ูุงุฆูุฉ ุงููุฏููุนุงุช
POST   /api/billing/payments                 - ุชุณุฌูู ุฏูุนุฉ
GET    /api/billing/payments/:id             - ุชูุงุตูู ุฏูุนุฉ
POST   /api/billing/payments/reconcile       - ุชุณููุฉ ุงููุฏููุนุงุช

# === ุจูุงุจุฉ ุงูุนููุงุก ===
GET    /api/portal/profile                   - ุจูุงูุงุช ุงูุนููู
PUT    /api/portal/profile                   - ุชุนุฏูู ุงูุจูุงูุงุช
GET    /api/portal/invoices                  - ููุงุชูุฑู
GET    /api/portal/payments                  - ูุฏููุนุงุชู
GET    /api/portal/consumption               - ุงุณุชููุงูู
POST   /api/portal/support/tickets           - ูุชุญ ุชุฐูุฑุฉ ุฏุนู
GET    /api/portal/support/tickets           - ุชุฐุงูุฑู
```

## 9. APIs ุงููุฑุงูุจุฉ ูุงูุชุญูู (`/api/scada/*`)

```
# === ุงููุญุทุงุช ===
GET    /api/scada/stations                   - ูุงุฆูุฉ ุงููุญุทุงุช
GET    /api/scada/stations/:id               - ุชูุงุตูู ูุญุทุฉ
GET    /api/scada/stations/:id/status        - ุญุงูุฉ ุงููุญุทุฉ
GET    /api/scada/stations/:id/readings      - ูุฑุงุกุงุช ุงููุญุทุฉ
GET    /api/scada/stations/:id/alarms        - ุชูุจููุงุช ุงููุญุทุฉ

# === ุงูุฃุฌูุฒุฉ ===
GET    /api/scada/devices                    - ูุงุฆูุฉ ุงูุฃุฌูุฒุฉ
GET    /api/scada/devices/:id                - ุชูุงุตูู ุฌูุงุฒ
GET    /api/scada/devices/:id/status         - ุญุงูุฉ ุงูุฌูุงุฒ
GET    /api/scada/devices/:id/readings       - ูุฑุงุกุงุช ุงูุฌูุงุฒ
POST   /api/scada/devices/:id/command        - ุฅุฑุณุงู ุฃูุฑ

# === ุงููุฑุงุกุงุช ===
GET    /api/scada/readings/live              - ุงููุฑุงุกุงุช ุงูุญูุฉ
GET    /api/scada/readings/history           - ุงููุฑุงุกุงุช ุงูุชุงุฑูุฎูุฉ
GET    /api/scada/readings/aggregate         - ุงููุฑุงุกุงุช ุงููุฌูุนุฉ

# === ุงูุชูุจููุงุช ===
GET    /api/scada/alarms                     - ูุงุฆูุฉ ุงูุชูุจููุงุช
GET    /api/scada/alarms/active              - ุงูุชูุจููุงุช ุงููุดุทุฉ
PUT    /api/scada/alarms/:id/acknowledge     - ุงูุฅูุฑุงุฑ ุจุงูุชูุจูู
PUT    /api/scada/alarms/:id/close           - ุฅุบูุงู ุงูุชูุจูู

# === ุงูุชุญูู ===
GET    /api/scada/controls                   - ููุงุท ุงูุชุญูู
POST   /api/scada/controls/:id/execute       - ุชูููุฐ ุฃูุฑ
GET    /api/scada/controls/:id/history       - ุชุงุฑูุฎ ุงูุฃูุงูุฑ

# === WebSocket ===
WS     /api/scada/ws/readings                - ุงููุฑุงุกุงุช ุงูุญูุฉ
WS     /api/scada/ws/alarms                  - ุงูุชูุจููุงุช ุงูุญูุฉ
WS     /api/scada/ws/status                  - ุญุงูุฉ ุงูุฃุฌูุฒุฉ
```

---

# ๐ ุชูุงููุงุช ุฅุถุงููุฉ

## ุชูุงูู RTU/PLC

```python
# ุฎุฏูุฉ ุงูุงุชุตุงู ุจู RTU ุนุจุฑ Modbus
class ModbusRTUService:
    """
    ุฎุฏูุฉ ุงูุงุชุตุงู ุจุฃุฌูุฒุฉ RTU ุนุจุฑ ุจุฑูุชูููู Modbus
    """
    
    def __init__(self, config):
        self.host = config['host']
        self.port = config['port']
        self.unit_id = config['unit_id']
        self.client = None
    
    async def connect(self):
        """ุฅูุดุงุก ุงุชุตุงู ูุน RTU"""
        from pymodbus.client import AsyncModbusTcpClient
        self.client = AsyncModbusTcpClient(self.host, port=self.port)
        await self.client.connect()
    
    async def read_holding_registers(self, address, count):
        """ูุฑุงุกุฉ Holding Registers"""
        result = await self.client.read_holding_registers(
            address=address,
            count=count,
            slave=self.unit_id
        )
        return result.registers if not result.isError() else None
    
    async def read_input_registers(self, address, count):
        """ูุฑุงุกุฉ Input Registers"""
        result = await self.client.read_input_registers(
            address=address,
            count=count,
            slave=self.unit_id
        )
        return result.registers if not result.isError() else None
    
    async def write_register(self, address, value):
        """ูุชุงุจุฉ ูููุฉ ูู Register"""
        result = await self.client.write_register(
            address=address,
            value=value,
            slave=self.unit_id
        )
        return not result.isError()
    
    async def write_coil(self, address, value):
        """ูุชุงุจุฉ ูููุฉ ูู Coil (ููุชุญูู)"""
        result = await self.client.write_coil(
            address=address,
            value=value,
            slave=self.unit_id
        )
        return not result.isError()
```

## ุชูุงูู IEC 61850

```python
# ุฎุฏูุฉ ุงูุงุชุตุงู ุจุฃุฌูุฒุฉ IEC 61850
class IEC61850Service:
    """
    ุฎุฏูุฉ ุงูุงุชุตุงู ุจุฃุฌูุฒุฉ ุงููุญุทุงุช ุนุจุฑ ุจุฑูุชูููู IEC 61850
    """
    
    def __init__(self, config):
        self.host = config['host']
        self.port = config.get('port', 102)
        self.connection = None
    
    async def connect(self):
        """ุฅูุดุงุก ุงุชุตุงู MMS"""
        # ุงุณุชุฎุฏุงู ููุชุจุฉ libiec61850
        pass
    
    async def read_data_object(self, logical_node, data_object):
        """ูุฑุงุกุฉ Data Object"""
        pass
    
    async def write_data_object(self, logical_node, data_object, value):
        """ูุชุงุจุฉ Data Object"""
        pass
    
    async def operate_control(self, control_object, operation):
        """ุชูููุฐ ุฃูุฑ ุชุญูู"""
        pass
    
    async def subscribe_reports(self, report_control_block, callback):
        """ุงูุงุดุชุฑุงู ูู ุงูุชูุงุฑูุฑ"""
        pass
```

## ุชูุงูู DNP3

```python
# ุฎุฏูุฉ ุงูุงุชุตุงู ุจุฃุฌูุฒุฉ DNP3
class DNP3Service:
    """
    ุฎุฏูุฉ ุงูุงุชุตุงู ุจุฃุฌูุฒุฉ RTU ุนุจุฑ ุจุฑูุชูููู DNP3
    """
    
    def __init__(self, config):
        self.host = config['host']
        self.port = config.get('port', 20000)
        self.master_address = config.get('master_address', 1)
        self.outstation_address = config.get('outstation_address', 10)
    
    async def connect(self):
        """ุฅูุดุงุก ุงุชุตุงู DNP3"""
        pass
    
    async def read_analog_inputs(self):
        """ูุฑุงุกุฉ ุงููุฏุฎูุงุช ุงูุชูุงุธุฑูุฉ"""
        pass
    
    async def read_binary_inputs(self):
        """ูุฑุงุกุฉ ุงููุฏุฎูุงุช ุงูุฑูููุฉ"""
        pass
    
    async def write_analog_output(self, index, value):
        """ูุชุงุจุฉ ูุฎุฑุฌ ุชูุงุธุฑู"""
        pass
    
    async def write_binary_output(self, index, value):
        """ูุชุงุจุฉ ูุฎุฑุฌ ุฑููู (CROB)"""
        pass
```

---

# ๐ WebSocket ููุจูุงูุงุช ุงูุญูุฉ

## ุฎุฏูุฉ WebSocket

```python
# ุฎุฏูุฉ WebSocket ููุจูุงูุงุช ุงูุญูุฉ
from fastapi import WebSocket, WebSocketDisconnect
from typing import Dict, Set
import asyncio
import json

class WebSocketManager:
    """
    ูุฏูุฑ ุงุชุตุงูุงุช WebSocket ููุจูุงูุงุช ุงูุญูุฉ
    """
    
    def __init__(self):
        # ุงูุงุชุตุงูุงุช ุงููุดุทุฉ ูุตููุฉ ุญุณุจ ุงูุบุฑูุฉ
        self.active_connections: Dict[str, Set[WebSocket]] = {}
        # ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฑุณุงุฆู
        self.message_queue = asyncio.Queue()
    
    async def connect(self, websocket: WebSocket, room: str):
        """ูุจูู ุงุชุตุงู ุฌุฏูุฏ"""
        await websocket.accept()
        if room not in self.active_connections:
            self.active_connections[room] = set()
        self.active_connections[room].add(websocket)
    
    def disconnect(self, websocket: WebSocket, room: str):
        """ุฅุฒุงูุฉ ุงุชุตุงู"""
        if room in self.active_connections:
            self.active_connections[room].discard(websocket)
    
    async def broadcast_to_room(self, room: str, message: dict):
        """ุฅุฑุณุงู ุฑุณุงูุฉ ูุฌููุน ุงููุชุตููู ูู ุบุฑูุฉ"""
        if room in self.active_connections:
            for connection in self.active_connections[room]:
                try:
                    await connection.send_json(message)
                except:
                    self.disconnect(connection, room)
    
    async def send_personal(self, websocket: WebSocket, message: dict):
        """ุฅุฑุณุงู ุฑุณุงูุฉ ูุงุชุตุงู ูุญุฏุฏ"""
        await websocket.send_json(message)

# ุฅูุดุงุก ูุฏูุฑ WebSocket
ws_manager = WebSocketManager()

# Endpoint ูููุฑุงุกุงุช ุงูุญูุฉ
@app.websocket("/api/scada/ws/readings")
async def websocket_readings(websocket: WebSocket, station_id: str = None):
    room = f"readings_{station_id}" if station_id else "readings_all"
    await ws_manager.connect(websocket, room)
    try:
        while True:
            # ุงูุชุธุงุฑ ุฑุณุงุฆู ูู ุงูุนููู (ูุซู ุชุบููุฑ ุงูููุงุชุฑ)
            data = await websocket.receive_json()
            # ูุนุงูุฌุฉ ุงูุฑุณุงูุฉ
            if data.get('action') == 'subscribe':
                # ุงูุงุดุชุฑุงู ูู ูุฑุงุกุงุช ูุญุฏุฏุฉ
                pass
    except WebSocketDisconnect:
        ws_manager.disconnect(websocket, room)

# Endpoint ููุชูุจููุงุช ุงูุญูุฉ
@app.websocket("/api/scada/ws/alarms")
async def websocket_alarms(websocket: WebSocket):
    await ws_manager.connect(websocket, "alarms")
    try:
        while True:
            await websocket.receive_text()
    except WebSocketDisconnect:
        ws_manager.disconnect(websocket, "alarms")

# ุฎุฏูุฉ ูุดุฑ ุงููุฑุงุกุงุช
async def publish_readings(station_id: str, readings: dict):
    """ูุดุฑ ุงููุฑุงุกุงุช ูุฌููุน ุงููุดุชุฑููู"""
    await ws_manager.broadcast_to_room(f"readings_{station_id}", {
        "type": "readings",
        "station_id": station_id,
        "data": readings,
        "timestamp": datetime.utcnow().isoformat()
    })
    await ws_manager.broadcast_to_room("readings_all", {
        "type": "readings",
        "station_id": station_id,
        "data": readings,
        "timestamp": datetime.utcnow().isoformat()
    })

# ุฎุฏูุฉ ูุดุฑ ุงูุชูุจููุงุช
async def publish_alarm(alarm: dict):
    """ูุดุฑ ุชูุจูู ุฌุฏูุฏ"""
    await ws_manager.broadcast_to_room("alarms", {
        "type": "alarm",
        "data": alarm,
        "timestamp": datetime.utcnow().isoformat()
    })
```

---

# ๐ ุฌุฏุงูู ุฅุถุงููุฉ

## ุฌุฏูู ุงุชุตุงูุงุช WebSocket

```sql
CREATE TABLE websocket_connections (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    business_id UUID REFERENCES businesses(id),
    
    -- ูุนูููุงุช ุงูุงุชุตุงู
    connection_id VARCHAR(100) NOT NULL,
    user_id UUID REFERENCES users(id),
    room VARCHAR(100) NOT NULL,
    
    -- ูุนูููุงุช ุงูุนููู
    client_ip VARCHAR(45),
    user_agent TEXT,
    
    -- ุงูุญุงูุฉ
    connected_at TIMESTAMP DEFAULT NOW(),
    disconnected_at TIMESTAMP,
    last_activity_at TIMESTAMP DEFAULT NOW(),
    
    -- ุงูุฅุญุตุงุฆูุงุช
    messages_sent INT DEFAULT 0,
    messages_received INT DEFAULT 0
);

CREATE INDEX idx_ws_connections_room ON websocket_connections(room);
CREATE INDEX idx_ws_connections_user ON websocket_connections(user_id);
```

## ุฌุฏูู ุจุฑูุชููููุงุช ุงูุงุชุตุงู

```sql
CREATE TABLE communication_protocols (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    business_id UUID REFERENCES businesses(id),
    
    -- ูุนูููุงุช ุงูุจุฑูุชูููู
    name VARCHAR(100) NOT NULL,
    protocol_type VARCHAR(50) NOT NULL, -- modbus, dnp3, iec61850, mqtt
    
    -- ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู
    host VARCHAR(255) NOT NULL,
    port INT NOT NULL,
    settings JSONB, -- ุฅุนุฏุงุฏุงุช ุฎุงุตุฉ ุจุงูุจุฑูุชูููู
    
    -- ุงููุตุงุฏูุฉ
    auth_type VARCHAR(50), -- none, basic, certificate
    credentials JSONB,
    
    -- ุงูุญุงูุฉ
    is_active BOOLEAN DEFAULT true,
    last_connected_at TIMESTAMP,
    connection_status VARCHAR(20) DEFAULT 'disconnected',
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

## ุฌุฏูู ููุงุท ุงูุจูุงูุงุช

```sql
CREATE TABLE data_points (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    business_id UUID REFERENCES businesses(id),
    protocol_id UUID REFERENCES communication_protocols(id),
    device_id UUID REFERENCES devices(id),
    
    -- ูุนูููุงุช ุงูููุทุฉ
    name VARCHAR(100) NOT NULL,
    description TEXT,
    point_type VARCHAR(50) NOT NULL, -- analog_input, analog_output, binary_input, binary_output
    
    -- ุงูุนููุงู
    address VARCHAR(100) NOT NULL, -- ุงูุนููุงู ุญุณุจ ุงูุจุฑูุชูููู
    data_type VARCHAR(50) NOT NULL, -- int16, int32, float32, boolean
    
    -- ุงูุชุญููู
    scale_factor DECIMAL(10, 6) DEFAULT 1,
    offset DECIMAL(10, 6) DEFAULT 0,
    unit VARCHAR(20),
    
    -- ุงูุญุฏูุฏ
    low_limit DECIMAL(15, 4),
    high_limit DECIMAL(15, 4),
    alarm_low DECIMAL(15, 4),
    alarm_high DECIMAL(15, 4),
    
    -- ุงููุฑุงุกุฉ
    scan_rate_ms INT DEFAULT 1000,
    last_value DECIMAL(15, 4),
    last_quality VARCHAR(20),
    last_timestamp TIMESTAMP,
    
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_data_points_device ON data_points(device_id);
CREATE INDEX idx_data_points_protocol ON data_points(protocol_id);
```


---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ ูููุธุงู

### ูุนูููุงุช ุงููุณุชูุฏุน

| ุงูุนูุตุฑ | ุงููููุฉ |
|--------|--------|
| **ุงุณู ุงููุณุชูุฏุน** | `developer-system` |
| **ุงููููุฐ API** | 3002 |
| **ุงููููุฐ Web** | 4202 |
| **ุจุงุฏุฆุฉ ุงูุฌุฏุงูู** | `dev_` |
| **ูุณุงุฑ API** | `/api/v1/developer` |

### ูููู ุงููุณุชูุฏุน

```
developer-system/
โโโ apps/
โ   โโโ web/                          # Angular Frontend
โ   โ   โโโ src/
โ   โ   โ   โโโ app/
โ   โ   โ   โ   โโโ core/
โ   โ   โ   โ   โโโ shared/
โ   โ   โ   โ   โโโ features/
โ   โ   โ   โ       โโโ dashboard/
โ   โ   โ   โ       โโโ integrations/
โ   โ   โ   โ       โโโ api-keys/
โ   โ   โ   โ       โโโ webhooks/
โ   โ   โ   โ       โโโ events/
โ   โ   โ   โ       โโโ ai-models/
โ   โ   โ   โ       โโโ monitoring/
โ   โ   โ   โโโ assets/i18n/
โ   โ   โโโ project.json
โ   โ
โ   โโโ api/                          # NestJS Backend
โ       โโโ src/
โ       โ   โโโ modules/
โ       โ   โ   โโโ integrations/
โ       โ   โ   โโโ api-keys/
โ       โ   โ   โโโ webhooks/
โ       โ   โ   โโโ events/
โ       โ   โ   โโโ ai/
โ       โ   โ   โโโ monitoring/
โ       โ   โโโ common/
โ       โ   โโโ prisma/
โ       โโโ project.json
โ
โโโ prisma/
โ   โโโ schema.prisma
โโโ docker-compose.yml
โโโ package.json
```

### Prisma Schema (ูุธุงู ุงููุทูุฑ)

```prisma
// prisma/schema.prisma

// ==================== Developer System Tables ====================

// ุงูุชูุงููุงุช
model dev_integrations {
  id            String   @id @default(uuid()) @db.Uuid
  code          String   @unique @db.VarChar(50)
  name          String   @db.VarChar(200)
  type          String   @db.VarChar(50) // payment_gateway, sms, email, iot, erp
  
  provider      String   @db.VarChar(100)
  baseUrl       String?  @map("base_url") @db.VarChar(500)
  
  config        Json     @default("{}")
  credentials   Json     @default("{}")
  
  isActive      Boolean  @default(true) @map("is_active")
  lastSyncAt    DateTime? @map("last_sync_at")
  
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  logs          dev_integration_logs[]
  
  @@map("dev_integrations")
}

// ุณุฌูุงุช ุงูุชูุงูู
model dev_integration_logs {
  id            String   @id @default(uuid()) @db.Uuid
  integrationId String   @map("integration_id") @db.Uuid
  
  direction     String   @db.VarChar(10) // inbound, outbound
  method        String   @db.VarChar(10)
  endpoint      String   @db.VarChar(500)
  
  requestBody   Json?    @map("request_body")
  responseBody  Json?    @map("response_body")
  statusCode    Int?     @map("status_code")
  
  duration      Int?     // milliseconds
  error         String?  @db.Text
  
  createdAt     DateTime @default(now()) @map("created_at")
  
  integration   dev_integrations @relation(fields: [integrationId], references: [id])
  
  @@index([integrationId])
  @@index([createdAt])
  @@map("dev_integration_logs")
}

// ููุงุชูุญ API
model dev_api_keys {
  id            String   @id @default(uuid()) @db.Uuid
  name          String   @db.VarChar(100)
  keyHash       String   @unique @map("key_hash") @db.VarChar(255)
  keyPrefix     String   @map("key_prefix") @db.VarChar(20)
  
  systemId      String?  @map("system_id") @db.VarChar(50)
  permissions   Json     @default("[]")
  
  rateLimit     Int      @default(1000) @map("rate_limit")
  expiresAt     DateTime? @map("expires_at")
  lastUsedAt    DateTime? @map("last_used_at")
  
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  
  @@map("dev_api_keys")
}

// ุงูุฃุญุฏุงุซ
model dev_events {
  id            String   @id @default(uuid()) @db.Uuid
  eventType     String   @map("event_type") @db.VarChar(100)
  
  sourceSystem  String   @map("source_system") @db.VarChar(50)
  targetSystem  String?  @map("target_system") @db.VarChar(50)
  
  payload       Json
  metadata      Json     @default("{}")
  
  status        String   @default("pending") @db.VarChar(20)
  processedAt   DateTime? @map("processed_at")
  error         String?  @db.Text
  retryCount    Int      @default(0) @map("retry_count")
  
  createdAt     DateTime @default(now()) @map("created_at")
  
  @@index([eventType])
  @@index([sourceSystem])
  @@index([status])
  @@index([createdAt])
  @@map("dev_events")
}

// Webhooks
model dev_webhooks {
  id            String   @id @default(uuid()) @db.Uuid
  name          String   @db.VarChar(100)
  url           String   @db.VarChar(500)
  
  events        Json     @default("[]") // ูุงุฆูุฉ ุงูุฃุญุฏุงุซ ุงููุดุชุฑู ูููุง
  headers       Json     @default("{}")
  
  secret        String?  @db.VarChar(255)
  isActive      Boolean  @default(true) @map("is_active")
  
  lastTriggeredAt DateTime? @map("last_triggered_at")
  failureCount  Int      @default(0) @map("failure_count")
  
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  deliveries    dev_webhook_deliveries[]
  
  @@map("dev_webhooks")
}

// ุชุณูููุงุช Webhook
model dev_webhook_deliveries {
  id            String   @id @default(uuid()) @db.Uuid
  webhookId     String   @map("webhook_id") @db.Uuid
  eventId       String   @map("event_id") @db.Uuid
  
  requestBody   Json     @map("request_body")
  responseBody  Json?    @map("response_body")
  statusCode    Int?     @map("status_code")
  
  duration      Int?
  error         String?  @db.Text
  
  createdAt     DateTime @default(now()) @map("created_at")
  
  webhook       dev_webhooks @relation(fields: [webhookId], references: [id])
  
  @@index([webhookId])
  @@index([createdAt])
  @@map("dev_webhook_deliveries")
}

// ููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
model dev_ai_models {
  id            String   @id @default(uuid()) @db.Uuid
  code          String   @unique @db.VarChar(50)
  name          String   @db.VarChar(200)
  type          String   @db.VarChar(50) // prediction, classification, anomaly_detection
  
  provider      String   @db.VarChar(50) // openai, local, custom
  modelVersion  String?  @map("model_version") @db.VarChar(50)
  
  config        Json     @default("{}")
  metrics       Json     @default("{}")
  
  isActive      Boolean  @default(true) @map("is_active")
  lastTrainedAt DateTime? @map("last_trained_at")
  
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  predictions   dev_ai_predictions[]
  
  @@map("dev_ai_models")
}

// ุชูุจุคุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
model dev_ai_predictions {
  id            String   @id @default(uuid()) @db.Uuid
  modelId       String   @map("model_id") @db.Uuid
  
  inputData     Json     @map("input_data")
  prediction    Json
  confidence    Decimal? @db.Decimal(5, 4)
  
  actualValue   Json?    @map("actual_value")
  feedback      String?  @db.VarChar(50)
  
  createdAt     DateTime @default(now()) @map("created_at")
  
  model         dev_ai_models @relation(fields: [modelId], references: [id])
  
  @@index([modelId])
  @@index([createdAt])
  @@map("dev_ai_predictions")
}

// ููุงููุณ ุงูุฃุฏุงุก
model dev_metrics {
  id            String   @id @default(uuid()) @db.Uuid
  systemId      String   @map("system_id") @db.VarChar(50)
  metricType    String   @map("metric_type") @db.VarChar(50)
  
  value         Decimal  @db.Decimal(15, 4)
  unit          String?  @db.VarChar(20)
  tags          Json     @default("{}")
  
  timestamp     DateTime @default(now())
  
  @@index([systemId])
  @@index([metricType])
  @@index([timestamp])
  @@map("dev_metrics")
}

// ุงูุชูุจููุงุช
model dev_alerts {
  id            String   @id @default(uuid()) @db.Uuid
  code          String   @db.VarChar(50)
  title         String   @db.VarChar(200)
  message       String   @db.Text
  
  severity      String   @db.VarChar(20) // info, warning, error, critical
  sourceSystem  String   @map("source_system") @db.VarChar(50)
  
  metadata      Json     @default("{}")
  
  status        String   @default("active") @db.VarChar(20)
  acknowledgedBy String? @map("acknowledged_by") @db.Uuid
  acknowledgedAt DateTime? @map("acknowledged_at")
  resolvedAt    DateTime? @map("resolved_at")
  
  createdAt     DateTime @default(now()) @map("created_at")
  
  @@index([severity])
  @@index([sourceSystem])
  @@index([status])
  @@map("dev_alerts")
}
```

### NestJS Modules

```typescript
// src/app.module.ts
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { EventEmitterModule } from '@nestjs/event-emitter';
import { HttpModule } from '@nestjs/axios';
import { ScheduleModule } from '@nestjs/schedule';

import { PrismaModule } from './prisma/prisma.module';
import { IntegrationsModule } from './modules/integrations/integrations.module';
import { ApiKeysModule } from './modules/api-keys/api-keys.module';
import { WebhooksModule } from './modules/webhooks/webhooks.module';
import { EventsModule } from './modules/events/events.module';
import { AiModule } from './modules/ai/ai.module';
import { MonitoringModule } from './modules/monitoring/monitoring.module';

@Module({
  imports: [
    ConfigModule.forRoot({ isGlobal: true }),
    EventEmitterModule.forRoot(),
    ScheduleModule.forRoot(),
    HttpModule,
    PrismaModule,
    IntegrationsModule,
    ApiKeysModule,
    WebhooksModule,
    EventsModule,
    AiModule,
    MonitoringModule,
  ],
})
export class AppModule {}
```

### Environment Variables

```env
# .env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/electricity_management"

JWT_SECRET="developer-system-secret-key"
API_PORT=3002
API_PREFIX="api/v1"

# OpenAI ููุฐูุงุก ุงูุงุตุทูุงุนู
OPENAI_API_KEY="sk-..."

# URLs ุงูุฃูุธูุฉ ุงูุฃุฎุฑู
CORE_API_URL="http://localhost:3001/api/v1"
ASSETS_API_URL="http://localhost:3003/api/v1"
FIELD_OPS_API_URL="http://localhost:3004/api/v1"
SCADA_API_URL="http://localhost:3005/api/v1"
INVENTORY_API_URL="http://localhost:3006/api/v1"
BILLING_API_URL="http://localhost:3007/api/v1"
HR_API_URL="http://localhost:3008/api/v1"
REPORTS_API_URL="http://localhost:3009/api/v1"
PROJECTS_API_URL="http://localhost:3010/api/v1"
```
